<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta http-equiv="X-Content-Type-Options" content="nosniff">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PWA â€” Progressive Web App (iOS + Android)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Nom et description -->
<title>YAM ğŸ’•</title>
<meta name="application-name" content="YAM">
<meta name="description" content="Votre univers Ã  deux ğŸ’•">

<!-- Manifest -->
<link rel="manifest" href="manifest.json">

<!-- iOS : mode plein Ã©cran (pas de barre Safari) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="YAM ğŸ’•">

<!-- iOS : icÃ´nes (chaque taille pour chaque device) -->
<link rel="apple-touch-icon" href="assets/icons/icon-180.png">
<link rel="apple-touch-icon" sizes="152x152" href="assets/icons/icon-152.png">
<link rel="apple-touch-icon" sizes="167x167" href="assets/icons/icon-167.png">
<link rel="apple-touch-icon" sizes="180x180" href="assets/icons/icon-180.png">

<!-- iOS : couleur de la barre de statut -->
<meta name="theme-color" content="#0f0f1a">

<!-- iOS : splash screen couleur (pendant le chargement) -->
<meta name="msapplication-TileColor" content="#0f0f1a">

<!-- Favicon standard navigateur -->
<link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Enregistrement du Service Worker
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/yam-app/service-worker.js', { scope: '/yam-app/' })
        .then(function(reg) {
          console.log('âš¡ [PWA] Service Worker enregistrÃ© :', reg.scope);
        })
        .catch(function(err) {
          console.warn('[PWA] Service Worker Ã©chec :', err);
        });
    });
  }
</script>

<link rel="stylesheet" href="css/main.css">

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AVATARS PAR DÃ‰FAUT â€” profil_girl.png / profil_boy.png
   Remplace les emoji ğŸ‘§ğŸ‘¦ partout dans l'app
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function(){
  var BASE = 'assets/images/';
  var DEFAULTS = { girl: BASE+'profil_girl.png', boy: BASE+'profil_boy.png' };

  // Cache des vraies URLs (remplies par _acLoadPartnerAvatar / _acLoadAvatarTopbarOnStart)
  window._yamRealAvatars = { girl: null, boy: null };

  // Retourne l'URL rÃ©elle si disponible, sinon le dÃ©faut
  function getSrc(role){
    return window._yamRealAvatars[role] || DEFAULTS[role] || DEFAULTS.girl;
  }

  // Retourne une balise <img> HTML prÃªte Ã  l'emploi
  window.yamAvatarHTML = function(role, sz){
    sz = sz || '100%';
    return '<img src="'+getSrc(role)+'" alt="" style="width:'+sz+';height:'+sz+';border-radius:50%;object-fit:cover;display:block;pointer-events:none;">';
  };

  // Injecte l'image dans un Ã©lÃ©ment DOM
  window.yamSetAvatar = function(el, role){
    if(!el) return;
    var src = getSrc(role);
    var img = el.querySelector('img.yam-av-img');
    if(!img){
      el.textContent = '';
      img = document.createElement('img');
      img.className = 'yam-av-img';
      img.alt = '';
      img.style.cssText = 'width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;';
      el.appendChild(img);
    }
    img.src = src;
  };

  // Retourne le src pour un rÃ´le
  window.yamAvatarSrc = function(role){ return getSrc(role); };

  // Met Ã  jour TOUS les Ã©lÃ©ments d'avatar visibles dans l'app pour un rÃ´le donnÃ©
  window._yamSyncAllAvatarsForRole = function(role, url){
    window._yamRealAvatars[role] = url;
    // SÃ©lectionner tous les Ã©lÃ©ments selon le rÃ´le
    var selectors = [];
    if(role === 'girl'){
      selectors = [
        '#profileAvatarOtherEmoji', // header principal â€” partenaire si je suis boy
        '#profileAvatarEmoji',      // header principal â€” moi si je suis girl
        '#yamMoodElleAvatar img',
        '#yamStickyAvatarOtherEmoji',
        '#yamStickyAvatarSelfEmoji',
        '.dm-avatar-girl img',      // toutes les bulles + header chat girl
        '#dmHeaderAvatarSelf img',
        '#dmHeaderAvatarOther img',
        '#mhpAvatar img',
        '#skyjoAvatarOpp img',
        '#skyjoAvatarMe img',
        '#skyjoFinalEmojiLeft img',
        '#skyjoFinalEmojiRight img'
      ];
    } else {
      selectors = [
        '#profileAvatarOtherEmoji',
        '#profileAvatarEmoji',
        '#yamMoodLuiAvatar img',
        '#yamStickyAvatarOtherEmoji',
        '#yamStickyAvatarSelfEmoji',
        '.dm-avatar-boy img',
        '#dmHeaderAvatarSelf img',
        '#dmHeaderAvatarOther img',
        '#mhpAvatar img',
        '#skyjoAvatarOpp img',
        '#skyjoAvatarMe img',
        '#skyjoFinalEmojiLeft img',
        '#skyjoFinalEmojiRight img'
      ];
    }
    // On met Ã  jour les Ã©lÃ©ments qui sont actuellement Ã  la valeur par dÃ©faut ou dÃ©jÃ  role=match
    document.querySelectorAll('.dm-avatar-' + role + ' img').forEach(function(img){ img.src = url; });
    // Header principal : mettre Ã  jour selon le profil actif
    var profile = (typeof getProfile === 'function') ? getProfile() : null;
    // Moi
    if(profile === role){
      var selfEl = document.getElementById('profileAvatarEmoji'); if(selfEl) selfEl.src = url;
      var selfMood = document.getElementById(role === 'girl' ? 'yamMoodElleAvatar' : 'yamMoodLuiAvatar');
      if(selfMood){ var i = selfMood.querySelector('img'); if(i) i.src = url; }
      var stickyS = document.getElementById('yamStickyAvatarSelfEmoji'); if(stickyS) stickyS.src = url;
      var dmSelf = document.getElementById('dmHeaderAvatarSelf'); if(dmSelf){ var i2=dmSelf.querySelector('img'); if(i2) i2.src=url; }
    }
    // Partenaire
    if(profile && profile !== role){
      var othEl = document.getElementById('profileAvatarOtherEmoji'); if(othEl) othEl.src = url;
      var otherMood = document.getElementById(role === 'girl' ? 'yamMoodElleAvatar' : 'yamMoodLuiAvatar');
      if(otherMood){ var i3 = otherMood.querySelector('img'); if(i3) i3.src = url; }
      var stickyO = document.getElementById('yamStickyAvatarOtherEmoji'); if(stickyO) stickyO.src = url;
      var dmOther = document.getElementById('dmHeaderAvatarOther'); if(dmOther){ var i4=dmOther.querySelector('img'); if(i4) i4.src=url; }
      // mhpAvatar = partenaire qui envoie
      var mhp = document.getElementById('mhpAvatar'); if(mhp){ var i5=mhp.querySelector('img'); if(i5) i5.src=url; }
    }
  };
})();
</script>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STICKY MINI HEADER â€” ApparaÃ®t au scroll
     Nom de l'onglet actif, fond floutÃ©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="yamStickyHeader">
  <!-- Spacer gauche (symÃ©trie) -->
  <div style="width:56px;flex-shrink:0;"></div>
  <!-- Titre centrÃ© -->
  <span id="yamStickyHeaderTitle">Accueil</span>
  <!-- Avatars Ã  droite â€” miniatures des avatars du grand header -->
  <div id="yamStickyAvatars">
    <div id="yamStickyAvatarOther">
      <img id="yamStickyAvatarOtherEmoji" class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;">
      <div id="yamStickyPresenceDot"></div>
    </div>
    <div id="yamStickyAvatarSelf" onclick="yamStickyOpenProfile()">
      <img id="yamStickyAvatarSelfEmoji" class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;">
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     Ã‰CRAN LOGIN V2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="v2LoginOverlay">
  <div id="v2LoginBox">
    <div id="v2LoginLogo">ğŸ’•</div>
    <div id="v2LoginTitle">YAM</div>
    <div id="v2LoginSub">You And Me</div>

    <!-- Onglets -->
    <div id="v2LoginTabs">
      <button class="v2-tab active" id="v2TabLogin"    onclick="v2SwitchTab('login')">Connexion</button>
      <button class="v2-tab"        id="v2TabRegister" onclick="v2SwitchTab('register')">Inscription</button>
      <button class="v2-tab"        id="v2TabJoin"     onclick="v2SwitchTab('join')">Rejoindre</button>
    </div>

    <!-- Formulaire Connexion -->
    <div id="v2FormLogin" class="v2-form">
      <input class="v2-input" id="v2LoginPseudo"   type="text"     placeholder="Pseudo" autocomplete="username" />
      <input class="v2-input" id="v2LoginPassword" type="password" placeholder="Mot de passe" autocomplete="current-password" />
      <button class="v2-btn" onclick="v2DoLogin()">Se connecter</button>
    </div>

    <!-- Formulaire Inscription -->
    <div id="v2FormRegister" class="v2-form" style="display:none;">
      <input class="v2-input" id="v2RegPseudo"   type="text"     placeholder="Choisis un pseudo" autocomplete="username" />
      <input class="v2-input" id="v2RegPassword" type="password" placeholder="Mot de passe" autocomplete="new-password" />
      <div id="v2RoleSelect">
        <button class="v2-role-btn" id="v2RoleGirl" onclick="v2SelectRole('girl')"><img src="assets/images/profil_girl.png" alt="" style="width:22px;height:22px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:6px;"> Elle</button>
        <button class="v2-role-btn" id="v2RoleBoy"  onclick="v2SelectRole('boy')"><img src="assets/images/profil_boy.png" alt="" style="width:22px;height:22px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:6px;"> Lui</button>
      </div>
      <button class="v2-btn" onclick="v2DoRegister()">CrÃ©er mon compte</button>
      <div id="v2RegInfo" class="v2-info" style="display:none;"></div>
    </div>

    <!-- Formulaire Rejoindre -->
    <div id="v2FormJoin" class="v2-form" style="display:none;">
      <input class="v2-input" id="v2JoinPseudo"   type="text"     placeholder="Choisis un pseudo" autocomplete="username" />
      <input class="v2-input" id="v2JoinPassword" type="password" placeholder="Mot de passe" autocomplete="new-password" />
      <input class="v2-input" id="v2JoinCode"     type="text"     placeholder="Code couple (ex: YAM-4X9K)" autocomplete="off" style="text-transform:uppercase;letter-spacing:2px;" />
      <div id="v2JoinRoleSelect">
        <button class="v2-role-btn" id="v2JoinRoleGirl" onclick="v2SelectJoinRole('girl')"><img src="assets/images/profil_girl.png" alt="" style="width:22px;height:22px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:6px;"> Elle</button>
        <button class="v2-role-btn" id="v2JoinRoleBoy"  onclick="v2SelectJoinRole('boy')"><img src="assets/images/profil_boy.png" alt="" style="width:22px;height:22px;border-radius:50%;object-fit:cover;vertical-align:middle;margin-right:6px;"> Lui</button>
      </div>
      <button class="v2-btn" onclick="v2DoJoin()">Rejoindre</button>
    </div>

    <div id="v2LoginError" class="v2-error"></div>
    <div id="v2LoginLoader" class="v2-loader" style="display:none;">â³</div>
  </div>
</div>

<style>
#v2LoginOverlay {
  display: none;
  position: fixed; inset: 0; z-index: 9999;
  background: var(--bg);
  flex-direction: column; align-items: center; justify-content: center;
}
#v2LoginOverlay.active { display: flex; }
#v2LoginBox {
  width: 100%; max-width: 360px; padding: 32px 24px;
  background: var(--s1); border: 1px solid var(--border);
  border-radius: 24px; box-shadow: 0 8px 40px rgba(0,0,0,0.3);
  text-align: center;
}
#v2LoginLogo { font-size: 44px; margin-bottom: 4px; }
#v2LoginTitle { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; color: var(--text); }
#v2LoginSub { font-size: 13px; color: var(--muted); margin-bottom: 24px; }
#v2LoginTabs { display: flex; gap: 4px; margin-bottom: 20px; background: var(--s2); border-radius: 12px; padding: 4px; }
.v2-tab {
  flex: 1; padding: 8px 4px; font-size: 12px; font-weight: 600;
  font-family: 'DM Sans', sans-serif; background: transparent; border: none;
  border-radius: 8px; color: var(--muted); cursor: pointer; transition: all 0.2s;
}
.v2-tab.active { background: var(--s1); color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
.v2-form { display: flex; flex-direction: column; gap: 10px; }
.v2-input {
  width: 100%; padding: 12px 14px; font-size: 15px; font-family: 'DM Sans', sans-serif;
  background: var(--s2); border: 1px solid var(--border); border-radius: 10px;
  color: var(--text); outline: none; box-sizing: border-box; transition: border-color 0.2s;
}
.v2-input:focus { border-color: var(--green); }
.v2-btn {
  width: 100%; padding: 13px; margin-top: 4px; background: var(--green);
  color: #000; font-weight: 700; font-size: 15px; font-family: 'DM Sans', sans-serif;
  border: none; border-radius: 10px; cursor: pointer; transition: opacity 0.2s;
}
.v2-btn:hover { opacity: 0.88; }
#v2RoleSelect, #v2JoinRoleSelect { display: flex; gap: 8px; }
.v2-role-btn {
  flex: 1; padding: 10px; background: var(--s2); border: 1.5px solid var(--border);
  border-radius: 10px; color: var(--text); font-size: 14px; font-weight: 600;
  font-family: 'DM Sans', sans-serif; cursor: pointer; transition: all 0.2s;
}
.v2-role-btn.selected { border-color: var(--green); background: rgba(0,201,167,0.1); }
.v2-error { font-size: 12px; color: #e05555; margin-top: 8px; min-height: 18px; }
.v2-info { font-size: 13px; color: var(--green); margin-top: 8px; line-height: 1.5; }
.v2-loader { font-size: 20px; margin-top: 8px; }

/* â”€â”€ RÃ©actions Skyjo â”€â”€ */
#sjReactBtn {
  position: absolute;
  bottom: 44px;
  left: 10px;
  width: 46px;
  height: 46px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.15);
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(8px);
  padding: 0;
  cursor: pointer;
  z-index: 30;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.15s, opacity 0.2s, border-color 0.2s;
  box-shadow: 0 2px 10px rgba(0,0,0,0.4);
}
#sjReactBtn:active { transform: scale(0.92); }
#sjReactBtn.sj-react-cooldown { opacity: 0.45; pointer-events: none; }
#sjReactBtn img { width: 28px; height: 28px; object-fit: contain; }

#sjReactPicker {
  position: absolute;
  bottom: 98px;
  left: 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 31;
  opacity: 0;
  pointer-events: none;
  transform: translateY(12px) scale(0.9);
  transform-origin: bottom left;
  transition: opacity 0.2s, transform 0.2s cubic-bezier(.17,.89,.32,1.28);
}
#sjReactPicker.open {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0) scale(1);
}
.sj-react-option {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.18);
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(8px);
  padding: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.15s, background 0.15s;
  box-shadow: 0 2px 8px rgba(0,0,0,0.45);
}
.sj-react-option:active { transform: scale(1.2); background: rgba(255,255,255,0.12); }
.sj-react-option img { width: 28px; height: 28px; object-fit: contain; }

/* Bulles de rÃ©action */
.sj-reaction-bubble {
  position: absolute;
  z-index: 40;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s;
}
.sj-reaction-bubble.visible { opacity: 1; }
.sj-reaction-bubble.hiding { opacity: 0; }

.sj-bubble-me {
  bottom: 28%;
  left: 8px;
}
.sj-bubble-opp {
  top: 60px;
  left: 10px;
}

.sj-reaction-bubble img {
  width: 64px;
  height: 64px;
  object-fit: contain;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.55));
  animation: sjBubblePop 0.35s cubic-bezier(.17,.89,.32,1.28) forwards;
}
@keyframes sjBubblePop {
  0%  { transform: scale(0.3) rotate(-8deg); }
  70% { transform: scale(1.15) rotate(4deg); }
  100%{ transform: scale(1) rotate(0deg); }
}
/* â”€â”€ Timer bar â”€â”€ */
#sjTimerBar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: rgba(255,255,255,0.08);
  z-index: 20;
  overflow: hidden;
  opacity: 0;
  transition: opacity 0.3s;
  border-radius: 0 0 4px 4px;
}
#sjTimerBar.active { opacity: 1; }
#sjTimerBarFill {
  height: 100%;
  width: 100%;
  transform-origin: left center;
  background: linear-gradient(90deg, #00c9a7, #5b9cf6);
  transition: background 0.5s;
  will-change: transform;
}
#sjTimerBar.danger #sjTimerBarFill {
  background: linear-gradient(90deg, #e05555, #f97316);
}
@keyframes sjTimerPulse {
  0%, 100% { opacity: 1; }
  50%       { opacity: 0.5; }
}
#sjTimerBar.danger {
  animation: sjTimerPulse 0.6s ease-in-out infinite;
}
</style>


<div id="uxToast"></div>

<canvas id="particleCanvas"></canvas>
<canvas id="annivCanvas"></canvas>

<!-- BanniÃ¨re anniversaire mensuel -->
<div id="annivBanner">
  <span class="anniv-emoji">ğŸ‰</span>
  <div class="anniv-title" id="annivTitle">Bonne mensiversaire mon amour ğŸ’‘</div>
  <div class="anniv-sub" id="annivSub"></div>
</div>
<div id="floatingThemeBtn" title="Changer le thÃ¨me" style="display:none;">ğŸŒ™</div>

<header style="position:relative;">

  <!-- SystÃ¨me double avatar profil + humeur -->
  <div id="profileAvatarWrap">
    <!-- Avatar de l'autre (secondaire, bas-gauche) -->
    <div id="profileAvatarOther">
      <img id="profileAvatarOtherEmoji" class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;">
      <div id="presenceDot"></div>
    </div>
    <!-- Bulle emoji humeur â€” positionnÃ©e en haut-gauche de l'avatar -->
    <div id="profileMoodOther"></div>
    <!-- Capsule qui se dÃ©plie vers la gauche depuis la bulle -->
    <div id="moodBandeau" onclick="triggerMoodBandeau()">
      <span id="moodBandeauText" style="margin-right:4px;"></span>
      <span id="moodBandeauEmoji" style="font-size:13px;line-height:1;flex-shrink:0;"></span>
    </div>
    <!-- Avatar principal (sÃ©lectionnÃ©) -->
    <div id="profileAvatar" onclick="toggleProfilePopup()">
      <img id="profileAvatarEmoji" class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;">
      <div id="profileMoodSelf"></div>
    </div>
  </div>

  <div id="profilePopup">
    <div class="profile-popup-label">Qui es-tu ?</div>
    <div class="profile-popup-btn" id="ppBtnGirl" onclick="setProfile('girl')">
      <span class="profile-popup-dot girl"></span> <span id="profilePopupGirlName">Elle</span>
    </div>
    <div class="profile-popup-btn" id="ppBtnBoy" onclick="setProfile('boy')">
      <span class="profile-popup-dot boy"></span> <span id="profilePopupBoyName">Lui</span>
    </div>
    <div class="profile-popup-sep" style="display:none;"></div>
    <div class="profile-popup-btn" id="ppBtnMood" onclick="openMoodPicker(event)" style="display:none;">
      <span id="ppMoodIcon">ğŸ˜¶</span> Mon humeur
    </div>
    <div class="profile-popup-btn" id="ppBtnLogout" onclick="nativeLogout()" style="display:none;color:#e05555;border-color:rgba(224,85,85,0.3);">
      ğŸ”“ Se dÃ©connecter
    </div>
  </div>

  <!-- Picker humeur -->
  <div id="moodPicker">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:2px;">
      <div class="mood-picker-label" style="margin-bottom:0;">Comment tu te sens ?</div>
      <div class="mood-picker-close" onclick="closeMoodPicker()">âœ•</div>
    </div>
    <div class="mood-picker-grid" id="moodPickerGrid"></div>
    <div id="moodPickerDesc"></div>
  </div>

  <div class="hdr-tag">You And Me</div>
  <div class="hdr-name">YAM</div>
  <div class="hdr-sub">Notre univers en musique</div>
  <!-- Bouton thÃ¨me â€” dans le header, disparaÃ®t au scroll comme les avatars -->
  <button id="themeToggleHome" onclick="applyThemeToggle()" title="ThÃ¨me" style="
    position:absolute;
    top:12px;
    right:16px;
    width:34px; height:34px;
    border-radius:50%;
    background:var(--s2);
    border:1px solid var(--border);
    color:var(--sub);
    display:flex; align-items:center; justify-content:center;
    cursor:pointer;
    z-index:15;
    transition:background 0.2s, color 0.2s;
    padding:0;
  ">
    <svg id="homeThemeIconMoon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
    <svg id="homeThemeIconSun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
  </button>
</header>
<!-- Ligne de sÃ©paration dÃ©calÃ©e pour ne pas couper les avatars -->
<div style="height:1px;background:var(--border);margin-top:28px;"></div>

<!-- HIDDEN bubbleMenu refs preserved for JS compatibility â€” not displayed -->
<div id="topBubbleMenu" style="display:none;">
  <div class="bubbleBtn" id="themeToggle">ğŸŒ™</div>
  <div class="bubbleBtn" id="quizBtn">Quiz ğŸ’–</div>
  <div class="bubbleBtn" id="gamesBtn">Jeux ğŸ®</div>
  <div class="bubbleBtn" id="betisesBtn">BÃªtises ğŸ¤¡</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     YAM â€” ONGLET ACCUEIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="yamHomeTab" class="yam-tab-panel active">

  <!-- Zone mascotte YAM -->
  <div class="yam-mascotte-zone">
    <img src="https://raw.githubusercontent.com/jayaana/Playlist-love/main/yam_mascotte.png" alt="YAM mascotte" style="width:90px;height:90px;object-fit:contain;animation:yamFloat 3s ease-in-out infinite;" />
    <div class="yam-mascotte-label">YAM arrive bientÃ´t</div>
    <div class="yam-mascotte-sub">Votre compagnon de couple ğŸ’‘</div>
  </div>

  <!-- Humeur du couple + compteurs cÅ“urs -->
  <div class="yam-mood-strip">
    <div class="yam-mood-card" id="yamMoodElle">
      <div class="yam-mood-avatar" id="yamMoodElleAvatar"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
      <div class="yam-mood-info">
        <div class="yam-mood-name elle-name" id="yamMoodElleName">Elle</div>
        <div class="yam-mood-state" id="yamMoodElleState">â€”</div>
        <div class="yam-mood-likes" id="likeBadgeGirl"><span id="likeNumGirl" style="font-weight:700;color:#e879a0;">â€”</span> <span style="color:#e879a0;">â™¥</span></div>
      </div>
    </div>

    <!-- Bouton spam cÅ“ur central -->
    <div id="yamHeartSpamBtn" onclick="spawnHeart()" title="Envoie de l'amour !" style="
      width:52px;height:52px;border-radius:50%;
      background:linear-gradient(135deg,rgba(232,121,160,0.18),rgba(255,110,176,0.12));
      border:1.5px solid rgba(232,121,160,0.4);
      display:flex;align-items:center;justify-content:center;
      font-size:26px;cursor:pointer;flex-shrink:0;
      transition:transform 0.15s,box-shadow 0.15s,border-color 0.15s;
      box-shadow:0 4px 16px rgba(232,121,160,0.15);
      -webkit-tap-highlight-color:transparent;
      user-select:none;">ğŸ’—</div>

    <div class="yam-mood-card" id="yamMoodLui">
      <div class="yam-mood-avatar" id="yamMoodLuiAvatar"><img class="yam-av-img" src="assets/images/profil_boy.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
      <div class="yam-mood-info">
        <div class="yam-mood-name lui-name" id="yamMoodLuiName">Lui</div>
        <div class="yam-mood-state" id="yamMoodLuiState">â€”</div>
        <div class="yam-mood-likes" id="likeBadgeBoy"><span id="likeNumBoy" style="font-weight:700;color:#5b9cf6;">â€”</span> <span style="color:#5b9cf6;">â™¥</span></div>
      </div>
    </div>
  </div>

  <!-- Compteur -->
  <div class="section fade-in">
    <div class="section-label">On compte les jours</div>
    <div class="counter-block" id="counterBlock">
      <div class="counter-block-top"></div>
      <div class="counter-block-inner">
        <div class="counter-block-unit main-unit">
          <span class="c-num c-num-big" id="cnt-days">0</span>
          <span class="c-lbl">Jours</span>
        </div>
        <div class="counter-block-sep">:</div>
        <div class="counter-block-unit">
          <span class="c-num" id="cnt-hours">00</span>
          <span class="c-lbl">Heures</span>
        </div>
        <div class="counter-block-sep">:</div>
        <div class="counter-block-unit">
          <span class="c-num" id="cnt-mins">00</span>
          <span class="c-lbl">Min</span>
        </div>
        <div class="counter-block-sep">:</div>
        <div class="counter-block-unit">
          <span class="c-num" id="cnt-secs">00</span>
          <span class="c-lbl">Sec</span>
        </div>
      </div>
    </div>
    <div class="counter-since"></div>
  </div>

  <!-- Raison alÃ©atoire -->
  <div class="section fade-in" id="reasonSection">
    <div class="section-label">Pourquoi je t'aime</div>
    <div id="reasonBox">
      <span class="r-label">Une raison parmi tant d'autres âœ¨</span>
      <div id="reasonText">...</div>
      <span class="r-hint">ğŸ‘† Tape pour en dÃ©couvrir une autre</span>
    </div>
  </div>


</div><!-- /yamHomeTab -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     YAM â€” ONGLET NOUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="yamNousTab" class="yam-tab-panel">

<div class="section fade-in" id="timelineSection">
  <div class="section-label">Notre histoire</div>

  <!-- Timeline textuelle (visible par dÃ©faut, cachÃ©e pendant la fenÃªtre vidÃ©o) -->
  <div id="tlContent">
    <div class="tl-wrap collapsed" id="tlWrap">
      <div class="tl-line"></div>
      <div class="tl-item">
        <div class="tl-dot"></div>
        <div class="tl-date">19 octobre 2024</div>
        <div class="tl-card"><h3>Le premier message ğŸ’¬</h3><p>Quelques mots Ã©changÃ©s en ligne. Un "vas au McDo", on savait pas encore que Ã§a allait tout changer.</p></div>
      </div>
      <div class="tl-item">
        <div class="tl-dot"></div>
        <div class="tl-date">29 octobre 2024</div>
        <div class="tl-card"><h3>"Tu veux Ãªtre ma gentille ?" ğŸ’˜</h3><p>Et t'as fini d'Ãªtre aigrie. Le destin a dÃ©cidÃ© pour nous â€” et on a bien fait de l'Ã©couter.</p></div>
      </div>
      <div class="tl-item">
        <div class="tl-dot"></div>
        <div class="tl-date">Aujourd'hui & toujours</div>
        <div class="tl-card"><h3>En construction... ğŸŒŸ</h3><p>Plein de chapitres Ã  Ã©crire ensemble encore.</p></div>
      </div>
    </div>
    <div class="tl-toggle" id="tlToggle">â–¾ Voir la suite</div>
  </div>

  <!-- VidÃ©o Ã©vÃ©nementielle (cachÃ©e par dÃ©faut, visible Â±10min autour des heures dÃ©clenchantes) -->
  <div id="storyVideoWrap" style="display:none;position:relative;overflow:hidden;border-radius:14px;text-align:center;background:#d4b896;">

    <!-- VidÃ©o en taille naturelle, centrÃ©e horizontalement -->
    <video id="storyVideo" src="assets/videos/video-1.mp4" playsinline webkit-playsinline loop muted
      style="height:220px;width:auto;display:inline-block;vertical-align:top;"
      preload="none">
    </video>

    <!-- Fondu gauche -->
    <div style="position:absolute;top:0;left:0;width:14%;height:100%;pointer-events:none;z-index:2;background:linear-gradient(to right, #d4b896 0%, transparent 100%);"></div>
    <!-- Fondu droit -->
    <div style="position:absolute;top:0;right:0;width:14%;height:100%;pointer-events:none;z-index:2;background:linear-gradient(to left, #d4b896 0%, transparent 100%);"></div>
    <!-- Fondu haut -->
    <div style="position:absolute;top:0;left:0;right:0;height:14%;pointer-events:none;z-index:2;background:linear-gradient(to bottom, #d4b896 0%, transparent 100%);"></div>
    <!-- Fondu bas -->
    <div style="position:absolute;bottom:0;left:0;right:0;height:14%;pointer-events:none;z-index:2;background:linear-gradient(to top, #d4b896 0%, transparent 100%);"></div>

    <!-- Coeur battant -->
    <div id="storyHeart">â¤ï¸</div>

    <!-- Compte Ã  rebours -->
    <div id="storyCountdown" style="position:absolute;bottom:10px;left:12px;z-index:3;display:flex;align-items:center;gap:5px;background:rgba(0,0,0,0.45);backdrop-filter:blur(6px);border-radius:20px;padding:3px 9px;border:1px solid rgba(255,255,255,0.10);">
      <div style="width:5px;height:5px;border-radius:50%;background:var(--green);animation:blink 2s ease-in-out infinite;flex-shrink:0;"></div>
      <span id="storyCountdownTxt" style="font-size:10px;font-weight:700;color:var(--green);font-family:'DM Sans',sans-serif;letter-spacing:1px;"></span>
    </div>
  </div>
</div>



<div class="section fade-in" id="elleSection">
  <div class="section-label">Elle</div>
  <div class="slider" id="elleSlider">
    <div class="album-card lui-card-wrap" data-slot="elle-animal">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <img id="elle-img-animal" loading="lazy" decoding="async" src="" onload="this.classList.add('loaded')">
        <div class="skeleton-overlay" id="skel-elle-animal"></div>
        <div class="album-banner">Animal</div>
        <div class="lui-upload-btn" id="elle-btn-animal" onclick="elleUploadClick('animal')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Modifier</div>
        </div>
        <div class="lui-uploading" id="elle-loading-animal">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="elle-bar-animal"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="elle-desc-animal" onclick="elleEditDesc('animal')">Un regard doux ğŸ’«</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="elle-fleurs">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <img id="elle-img-fleurs" loading="lazy" decoding="async" src="" onload="this.classList.add('loaded')">
        <div class="skeleton-overlay" id="skel-elle-fleurs"></div>
        <div class="album-banner">Fleurs</div>
        <div class="lui-upload-btn" id="elle-btn-fleurs" onclick="elleUploadClick('fleurs')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Modifier</div>
        </div>
        <div class="lui-uploading" id="elle-loading-fleurs">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="elle-bar-fleurs"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="elle-desc-fleurs" onclick="elleEditDesc('fleurs')">Pleine de couleurs ğŸ’•</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="elle-personnage">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <img id="elle-img-personnage" loading="lazy" decoding="async" src="" onload="this.classList.add('loaded')">
        <div class="skeleton-overlay" id="skel-elle-personnage"></div>
        <div class="album-banner">Personnage</div>
        <div class="lui-upload-btn" id="elle-btn-personnage" onclick="elleUploadClick('personnage')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Modifier</div>
        </div>
        <div class="lui-uploading" id="elle-loading-personnage">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="elle-bar-personnage"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="elle-desc-personnage" onclick="elleEditDesc('personnage')">Attachante ğŸ’</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="elle-saison">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <img id="elle-img-saison" loading="lazy" decoding="async" src="" onload="this.classList.add('loaded')">
        <div class="skeleton-overlay" id="skel-elle-saison"></div>
        <div class="album-banner">Saison</div>
        <div class="lui-upload-btn" id="elle-btn-saison" onclick="elleUploadClick('saison')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Modifier</div>
        </div>
        <div class="lui-uploading" id="elle-loading-saison">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="elle-bar-saison"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="elle-desc-saison" onclick="elleEditDesc('saison')">Un rayon de soleil â˜€ï¸</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="elle-repas">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <img id="elle-img-repas" loading="lazy" decoding="async" src="" onload="this.classList.add('loaded')">
        <div class="skeleton-overlay" id="skel-elle-repas"></div>
        <div class="album-banner">Repas</div>
        <div class="lui-upload-btn" id="elle-btn-repas" onclick="elleUploadClick('repas')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Modifier</div>
        </div>
        <div class="lui-uploading" id="elle-loading-repas">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="elle-bar-repas"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="elle-desc-repas" onclick="elleEditDesc('repas')">N'aime que les pattes ğŸ¤</div>
    </div>
  </div>
  <input type="file" id="elleFileInput" accept="image/jpeg,image/png,image/webp" style="display:none" onchange="elleHandleFile(this)">
</div>

<div class="section fade-in" id="luiSection">
  <div class="section-label">Lui</div>
  <div class="slider" id="luiSlider">
    <div class="album-card lui-card-wrap" data-slot="animal">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <div class="lui-img-empty" id="lui-empty-animal"><div class="lui-img-empty-icon">ğŸ¾</div><div class="lui-img-empty-lbl">Animal</div></div>
        <img id="lui-img-animal" src="" style="display:none">
        <div class="album-banner">Animal</div>
        <div class="lui-upload-btn empty" id="lui-btn-animal" onclick="luiUploadClick('animal')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Ajouter</div>
        </div>
        <div class="lui-uploading" id="lui-loading-animal">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="lui-bar-animal"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="lui-desc-animal" onclick="luiEditDesc('animal')">Son animal ğŸ¾</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="fleurs">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <div class="lui-img-empty" id="lui-empty-fleurs"><div class="lui-img-empty-icon">ğŸŒ¸</div><div class="lui-img-empty-lbl">Fleurs</div></div>
        <img id="lui-img-fleurs" src="" style="display:none">
        <div class="album-banner">Fleurs</div>
        <div class="lui-upload-btn empty" id="lui-btn-fleurs" onclick="luiUploadClick('fleurs')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Ajouter</div>
        </div>
        <div class="lui-uploading" id="lui-loading-fleurs">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="lui-bar-fleurs"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="lui-desc-fleurs" onclick="luiEditDesc('fleurs')">Ses fleurs ğŸŒ¸</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="personnage">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <div class="lui-img-empty" id="lui-empty-personnage"><div class="lui-img-empty-icon">ğŸ§‘</div><div class="lui-img-empty-lbl">Personnage</div></div>
        <img id="lui-img-personnage" src="" style="display:none">
        <div class="album-banner">Personnage</div>
        <div class="lui-upload-btn empty" id="lui-btn-personnage" onclick="luiUploadClick('personnage')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Ajouter</div>
        </div>
        <div class="lui-uploading" id="lui-loading-personnage">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="lui-bar-personnage"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="lui-desc-personnage" onclick="luiEditDesc('personnage')">Son personnage ğŸ’™</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="saison">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <div class="lui-img-empty" id="lui-empty-saison"><div class="lui-img-empty-icon">ğŸ‚</div><div class="lui-img-empty-lbl">Saison</div></div>
        <img id="lui-img-saison" src="" style="display:none">
        <div class="album-banner">Saison</div>
        <div class="lui-upload-btn empty" id="lui-btn-saison" onclick="luiUploadClick('saison')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Ajouter</div>
        </div>
        <div class="lui-uploading" id="lui-loading-saison">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="lui-bar-saison"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="lui-desc-saison" onclick="luiEditDesc('saison')">Sa saison ğŸ‚</div>
    </div>
    <div class="album-card lui-card-wrap" data-slot="repas">
      <div class="album-image">
        <span class="album-heart">ğŸ¤</span>
        <div class="lui-img-empty" id="lui-empty-repas"><div class="lui-img-empty-icon">ğŸ½ï¸</div><div class="lui-img-empty-lbl">Repas</div></div>
        <img id="lui-img-repas" src="" style="display:none">
        <div class="album-banner">Repas</div>
        <div class="lui-upload-btn empty" id="lui-btn-repas" onclick="luiUploadClick('repas')">
          <div class="lui-upload-icon">ğŸ“·</div>
          <div class="lui-upload-lbl">Ajouter</div>
        </div>
        <div class="lui-uploading" id="lui-loading-repas">
          <div class="lui-upload-progress"><div class="lui-upload-bar" id="lui-bar-repas"></div></div>
          <div class="lui-upload-status">Envoi...</div>
        </div>
      </div>
      <div class="album-desc lui-desc-editable" id="lui-desc-repas" onclick="luiEditDesc('repas')">Son repas prÃ©fÃ©rÃ© ğŸ½ï¸</div>
    </div>
  </div>
  <!-- Input file cachÃ© â€” dÃ©clenchÃ© par JS -->
  <input type="file" id="luiFileInput" accept="image/jpeg,image/png,image/webp" style="display:none" onchange="luiHandleFile(this)">
</div>

<div id="memoCoupleSection" class="fade-in">
  <div class="memo-header-row">
    <div class="section-label" style="margin-bottom:0">MÃ©mo couple ğŸ“</div>
    <div class="memo-lock-badge" id="memoLockBadge" onclick="memoRequestUnlock()">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="currentColor" id="memoLockIcon">
        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
      </svg>
      <span id="memoLockTxt">Modifier</span>
    </div>
  </div>
  <div class="memo-sub-label">Notes</div>
  <div class="memo-notes-slider-wrap">
    <div class="memo-notes-slider" id="memoNotesSlider">
      <div class="memo-notes-empty">Chargement...</div>
    </div>
  </div>
  <div class="memo-sub-label" style="margin-top:18px">To-do</div>
  <div class="memo-todo-card">
    <div id="memoTodoList"><div class="todo-empty">Chargement...</div></div>
    <div class="todo-add-row" id="memoTodoAddRow" style="display:none">
      <input type="text" class="todo-add-input" id="memoTodoInput" placeholder="Ajouter un item..." maxlength="120">
      <button class="todo-add-btn" onclick="memoAddTodoItem()">+</button>
    </div>
  </div>
</div>

<div id="memoModal">
  <div class="memo-modal-inner">
    <span class="memo-modal-close" onclick="closeMemoModal()">âœ•</span>
    <div class="memo-modal-label">Note</div>
    <div id="memoModalView">
      <div class="memo-modal-content" id="memoModalContent"></div>
      <div class="memo-modal-date" id="memoModalDate"></div>
    </div>
    <div id="memoModalEdit" style="display:none">
      <input type="text" class="memo-modal-title-input" id="memoModalTitleInput" placeholder="Titre de la note..." maxlength="40">
      <textarea class="memo-modal-textarea" id="memoModalTextarea" placeholder="Ã‰cris ta note ici..."></textarea>
      <button class="memo-modal-save" onclick="memoSaveNote()">Sauvegarder ğŸ’¾</button>
      <button class="memo-modal-del" id="memoModalDelBtn" onclick="memoDeleteNote()">Supprimer cette note ğŸ—‘ï¸</button>
    </div>
  </div>
</div>

<div id="memoAuthModal">
  <div class="memo-auth-inner">
    <div class="memo-auth-icon">ğŸ”</div>
    <div class="memo-auth-title">Mode Ã©dition</div>
    <div class="memo-auth-sub">Entre le code pour modifier</div>
    <input type="password" class="memo-auth-input" id="memoAuthInput" placeholder="Code..." autocomplete="off">
    <button class="memo-auth-btn" onclick="memoCheckAuth()">Valider</button>
    <div class="memo-auth-err" id="memoAuthErr">âŒ Code incorrect, rÃ©essaie !</div>
    <span class="memo-auth-cancel" onclick="closeMemoAuth()">Annuler</span>
  </div>
</div>

<div class="section fade-in" id="postitsSection">
  <div class="section-label">Petits mots pour toi</div>
  <div class="postit-wrap" id="postitStack"></div>
  <div class="stack-hint">ğŸ‘† Tape ou swipe pour passer au suivant</div>
  <div class="stack-ctr" id="stackCounter"></div>
</div>

<div class="section fade-in" id="Books">
  <div class="section-label">IdÃ©es livre ğŸ“š</div>
  <div class="slider">
    <div class="album-card"><div class="album-image"><a href="https://booknode.com/la_saga_des_impossibles_tome_1_adam_03666756" target="_blank" rel="noopener noreferrer"><img src="https://jstiwtbgkbedtldqjdhp.supabase.co/storage/v1/object/public/images/image-6.jpg" onerror="this.onerror=null;this.src='assets/images/image-6.jpg'"></a><div class="album-banner">Adam</div></div><div class="album-desc">Une romance qui touche l'Ã¢me âœ¨</div></div>
    <div class="album-card"><div class="album-image"><a href="https://www.fnac.com/a18261401/Emma-Green-Ce-qui-nous-rend-vivants" target="_blank" rel="noopener noreferrer"><img src="https://jstiwtbgkbedtldqjdhp.supabase.co/storage/v1/object/public/images/image-7.jpg" onerror="this.onerror=null;this.src='assets/images/image-7.jpg'"></a><div class="album-banner">Ce qui nous rend vivants</div></div><div class="album-desc">Quand l'amour rÃ©vÃ¨le tout ğŸ’–</div></div>
    <div class="album-card"><div class="album-image"><a href="https://www.fnac.com/a17088484/Captive-Tome-1-Captive-Sarah-Rivens" target="_blank" rel="noopener noreferrer"><img src="https://jstiwtbgkbedtldqjdhp.supabase.co/storage/v1/object/public/images/image-8.jpg" onerror="this.onerror=null;this.src='assets/images/image-8.jpg'"></a><div class="album-banner">Captive</div></div><div class="album-desc">Passion et suspense ğŸ”¥</div></div>
    <div class="album-card"><div class="album-image"><a href="https://booknode.com/avant_toi_0690393" target="_blank" rel="noopener noreferrer"><img src="https://jstiwtbgkbedtldqjdhp.supabase.co/storage/v1/object/public/images/image-9.jpg" onerror="this.onerror=null;this.src='assets/images/image-9.jpg'"></a><div class="album-banner">Avant toi</div></div><div class="album-desc">Un amour impossible ğŸ’”</div></div>
    <div class="album-card"><div class="album-image"><a href="https://www.fnac.com/a7792857/Katarina-Bivald-La-Bibliotheque-des-coeurs-cabosses" target="_blank" rel="noopener noreferrer"><img src="https://jstiwtbgkbedtldqjdhp.supabase.co/storage/v1/object/public/images/image-10.jpg" onerror="this.onerror=null;this.src='assets/images/image-10.jpg'"></a><div class="album-banner">La bibliothÃ¨que des cÅ“urs cabossÃ©s</div></div><div class="album-desc">Ã‰motions Ã  chaque page ğŸ“š</div></div>
  </div>
</div>

<div id="wheelSection" class="fade-in">
  <div class="section-label" style="padding:26px 16px 0">On fait quoi ce soir ? ğŸ²</div>
  <div style="padding:0 16px">
    <div class="wheel-container">
      <div class="wheel-wrap">
        <canvas id="wheelCanvas"></canvas>
        <div class="wheel-needle">â—€</div>
        <div class="wheel-center"></div>
      </div>
      <button class="wheel-spin-btn" id="spinBtn">Tourner la roue âœ¨</button>
      <div id="wheelResult">
        <span class="result-label">En attente...</span>
        <span class="result-text">Lance la roue pour dÃ©cider ğŸ²</span>
      </div>
    </div>
  </div>
</div>

</div><!-- /yamNousTab -->
<div id="yamMusiqueTab" class="yam-tab-panel">

<div id="loveSection" class="fade-in">
  <div class="top50-header">
    <div class="top50-meta">Playlist</div>
    <div class="top50-title">Top 50 : Love ğŸ’•</div>
    <div class="top50-desc">Les sons de notre univers, classÃ©s par Ã©coutes.</div>
    <div class="top50-controls">
      <button class="top50-play-all" id="top50PlayAll" title="Tout lire">
        <svg id="top50IconPlay" viewBox="0 0 24 24" fill="currentColor" style="width:18px;height:18px;margin-left:2px"><path d="M8 5v14l11-7z"/></svg>
        <svg id="top50IconPause" viewBox="0 0 24 24" fill="currentColor" style="width:18px;height:18px;display:none"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
      </button>
      <button class="top50-mode-btn" id="top50ModeBtn" title="RÃ©pÃ©ter tout">
        <!-- Ordre -->
        <svg id="modeIconOrder" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/>
          <polyline points="16 9 20 6 16 3"/>
        </svg>
        <!-- AlÃ©atoire -->
        <svg id="modeIconShuffle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/>
          <polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/>
        </svg>
        <!-- RÃ©pÃ©ter tout -->
        <svg id="modeIconRepeatAll" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
          <polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
        </svg>
        <!-- RÃ©pÃ©ter une -->
        <svg id="modeIconRepeatOne" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
          <polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
          <text x="10.5" y="14.5" font-size="6.5" fill="currentColor" stroke="none" font-weight="800" font-family="sans-serif" text-anchor="middle">1</text>
        </svg>
      </button>
      <div class="top50-stats"><span id="top50Count">13</span> titres</div>
      <div id="nlOtherIndicator" style="display:none;margin-left:auto;align-items:center;gap:6px;">
        <span id="nlOtherDot" style="width:6px;height:6px;border-radius:50%;display:inline-block;flex-shrink:0;animation:nlIndPulse 1.6s ease-in-out infinite;"></span>
        <span id="nlOtherLabel" style="font-size:11px;font-weight:600;letter-spacing:0.2px;"></span>
        <span style="font-size:11px;">ğŸµ</span>
      </div>
    </div>
  </div>
  <div class="top50-col-header">
    <div class="col-h-num">#</div>
    <div class="col-h-title">Titre</div>
    <div class="col-h-plays">Ã‰coutes</div>
    <div class="col-h-actions"></div>
  </div>
  <div id="Love"></div>
  <div class="top50-expand" id="top50Expand">
    <span>Voir tout</span>
    <span class="top50-expand-icon">â–¾</span>
  </div>
</div>

<div style="padding: 22px 0 0;" class="fade-in">
  <div id="loveBox">
    <span class="lb-icon">ğŸ’—</span>
    <span class="lb-text" id="loveBoxText">Tapote-moi ğŸ¤«</span>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION AUTRE â€” SUGGESTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="fade-in" id="suggestionSection">
  <div class="suggestion-header-row">
    <div class="section-label" style="margin-bottom:0;padding:0;flex:1">Suggestions ğŸµ</div>
    <div class="suggestion-lock-badge" id="sgLockBadge" onclick="sgToggleLock()">
      <span class="sg-badge-dot"></span>
      <span id="sgLockTxt">Proposer une musique ğŸµ</span>
    </div>
  </div>
  <div>
    <div class="suggestion-col-header">
      <div style="flex:1;font-size:9px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px">Titre</div>
      <div style="width:110px;font-size:9px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;text-align:right;flex-shrink:0;padding-right:4px">Note</div>
      <div style="width:30px;flex-shrink:0"></div>
    </div>
    <div id="sgList"></div>
    <div class="sg-add-btn" id="sgAddBtn" onclick="openSgModal()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"/></svg>
      Proposer une musique
    </div>
  </div>
</div>

</div><!-- /yamMusiqueTab -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     YAM â€” ONGLET JEUX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="yamJeuxTab" class="yam-tab-panel">

  <div class="yam-jeux-header">
    <div class="section-label" style="margin-bottom:0">Jouer ensemble ğŸ®</div>
  </div>

  <!-- CTA BÃªtises -->
  <div class="yam-betises-cta" onclick="openPrankMenu()">
    <div class="yam-betises-cta-icon">ğŸ¤¡</div>
    <div>
      <div class="yam-betises-cta-label">Faire une bÃªtise</div>
      <div class="yam-betises-cta-sub">Surprends ton partenaire avec une farce</div>
    </div>
  </div>

  <!-- CTA Quiz -->
  <div class="yam-quiz-cta" onclick="document.getElementById('quizBtn').click()">
    <div style="font-size:26px;flex-shrink:0;">ğŸ’–</div>
    <div>
      <div style="font-size:14px;font-weight:700;color:var(--text);">Quiz couple</div>
      <div style="font-size:11px;color:var(--muted);margin-top:2px;">Tu me connais bien ?</div>
    </div>
  </div>

  <!-- Mini jeux grid â€” dÃ©clenche gamesView -->
  <div class="section fade-in" style="padding-top:18px;">
    <div class="section-label">Mini-jeux</div>
    <div onclick="document.getElementById('gamesBtn').click()" style="background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:16px;display:flex;align-items:center;gap:14px;cursor:pointer;transition:background 0.15s,transform 0.12s;" onmouseover="this.style.background='var(--s2)'" onmouseout="this.style.background='var(--s1)'">
      <span style="font-size:32px;">ğŸ®</span>
      <div>
        <div style="font-size:14px;font-weight:700;color:var(--text);">Tous les jeux</div>
        <div style="font-size:11px;color:var(--muted);margin-top:2px;">Memory Â· Snake Â· Pendu Â· Puzzle Â· Skyjo</div>
      </div>
      <svg style="margin-left:auto;flex-shrink:0;" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
  </div>

</div><!-- /yamJeuxTab -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MESSAGES TAB â€” InstaLove
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="yamMessagesTab" class="yam-tab-panel">
  <!-- FenÃªtre parasite supprimÃ©e â€” le clic nav ouvre directement InstaLove -->
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     NOUS TAB extra content (books + wheel)
     injected inside yamNousTab above,
     but books/wheel need to come before close
     â€” redone below as injection via the tag open
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="danceZone">
  <span id="dancerGirl">ğŸ’ƒ</span>
  <span id="dancerBoy">ğŸ•º</span>
</div>

<div id="quizView">
  <div class="qz-header">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
      <div class="qz-back" onclick="closeQuiz()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour</div>
      <button class="dm-topbar-theme" onclick="applyThemeToggle()" title="ThÃ¨me">
        <svg id="qzThemeIconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
        <svg id="qzThemeIconSun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      </button>
    </div>
    <div class="qz-title">Tu me connais bien ? ğŸ©·</div>
    <div class="qz-sub">10 questions tirÃ©es au hasard parmi toutes</div>
  </div>
  <div class="qz-progress-wrap">
    <div class="qz-progress-bar"><div class="qz-progress-fill" id="qzFill" style="width:0%"></div></div>
    <div class="qz-progress-txt" id="qzProgressTxt">0 / 10</div>
  </div>
  <div class="qz-card">
    <div class="qz-q-num" id="qzQNum">Question 1</div>
    <div class="qz-q-text" id="qzQText"></div>
  </div>
  <div id="qzHintBar"></div>
  <div class="qz-options" id="qzOptions"></div>
  <div class="qz-feedback" id="qzFeedback"></div>
  <button class="qz-next-btn" id="qzNextBtn">Question suivante â†’</button>
  <div class="qz-result" id="qzResult">
    <span class="qz-result-emoji" id="qzResultEmoji">ğŸ‰</span>
    <div class="qz-result-title" id="qzResultTitle"></div>
    <div class="qz-result-sub" id="qzResultSub"></div>
    <div class="qz-code-box" id="qzCodeBox">
      <div class="qz-code-label">Ton code secret ğŸ”</div>
      <div class="qz-code-val">Nemo</div>
      <div style="margin-top:8px;font-size:11px;color:rgba(61,155,212,0.6);font-style:italic;">Ã  utiliser dans le mode cachÃ© du site ğŸ¤«</div>
    </div>
    <button class="qz-retry-btn" onclick="startQuiz()">Recommencer ğŸ”„</button>
  </div>
</div>

<div class="bottom-nav">
  <div class="bottom-nav-inner">
    <div class="nav-item nav-active" id="navHome" onclick="yamSwitchTab('home')">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      Accueil
    </div>
    <div class="nav-item" id="navMessages" onclick="yamSwitchTab('messages')">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
      Messages
      <div id="lockUnreadBadge"></div>
    </div>
    <div class="nav-item" id="navJeux" onclick="yamSwitchTab('jeux')">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M15 7.5V2H9v5.5l3 3 3-3zM7.5 9H2v6h5.5l3-3-3-3zM9 16.5V22h6v-5.5l-3-3-3 3zM16.5 9l-3 3 3 3H22V9h-5.5z"/></svg>
      Jeux
    </div>
    <div class="nav-item" id="navMusique" onclick="yamSwitchTab('musique')">
      <!-- IcÃ´ne normale (note unique) -->
      <svg class="nav-music-solo" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
      <!-- IcÃ´ne sync (deux notes qui dansent ensemble) â€” visible uniquement en mode music-sync -->
      <span class="nav-music-sync-icon" aria-hidden="true">
        <svg class="nav-note-girl" width="16" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
        <svg class="nav-note-boy"  width="16" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
      </span>
      <span class="nav-music-label">Musique</span>
    </div>
    <div class="nav-item" id="navNous" onclick="yamSwitchTab('nous')">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      Nous
    </div>
  </div>
  <div class="bottom-nav-safe"></div>
</div>


<!-- Hidden compat elements for existing JS that references old nav items -->
<div id="lockNavBtn" style="display:none;"></div>
<div id="navSearch" style="display:none;"></div>

<div id="searchOverlay" onclick="if(event.target===this)closeSearch()">
  <div class="search-popup">
    <div class="search-popup-bar">
      <input type="text" id="searchInput" placeholder="Titre, artiste..." oninput="filterSongs(this.value)" autocomplete="off">
      <span class="search-close-btn" onclick="closeSearch()">âœ•</span>
    </div>
    <div id="searchResults"></div>
  </div>
</div>

<div id="libraryPopup">
  <div class="lib-item" onclick="goTo('memoCoupleSection')">ğŸ“ MÃ©mo couple</div>
  <div class="lib-item" onclick="goTo('Love')">ğŸ’• Love</div>
  <div class="lib-item" onclick="goTo('suggestionSection')">ğŸµ Suggestions</div>
  <div class="lib-item" onclick="goTo('Books')">ğŸ“š IdÃ©es livre</div>
</div>


<div id="lockPopup">
  <div style="padding:12px 14px 6px;font-size:9px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px">Mode cachÃ© ğŸ”</div>
  <div style="padding:0 10px 10px;display:flex;gap:7px;align-items:center">
    <input type="password" id="lockInput" placeholder="Tape le code..." autocomplete="off">
    <button id="lockSubmit" onclick="checkCode()">OK</button>
  </div>
  <div id="lockError" style="display:none;padding:0 13px 10px;font-size:11px;color:#ff6b6b"></div>
</div>

<div id="hiddenPage">

  <!-- TOPBAR â€” style header du site -->
  <div class="dm-topbar" id="dmTopbar" style="height:auto;min-height:60px;padding:10px 14px;padding-top:calc(var(--safe-top) + 10px);display:flex;align-items:center;justify-content:space-between;gap:10px;border-bottom:1px solid var(--border);">
    <!-- Bouton retour (cachÃ© au dÃ©part, visible en sous-Ã©crans) -->
    <div class="gv-back" id="dmTopbarBack" onclick="dmHandleBack()" style="flex-shrink:0;">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      <span id="dmBackLabel">Retour</span>
    </div>
    <!-- Titre centre (dynamique) -->
    <div class="dm-topbar-center" id="dmTopbarCenter" style="flex:1;min-width:0;overflow:hidden;">
      <!-- Contenu logo style site -->
      <div style="display:flex;flex-direction:column;line-height:1.2;">
        <span style="font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--green);">You And Me</span>
        <span style="font-family:'Playfair Display',serif;font-size:17px;font-weight:700;color:var(--text);line-height:1.1;">YAM</span>
      </div>
    </div>
    <!-- Droite : avatars + thÃ¨me -->
    <div style="display:flex;align-items:center;gap:8px;flex-shrink:0;">
      <!-- Avatars profil avec Ã©tat de connexion -->
      <div id="dmHeaderAvatars" style="display:flex;align-items:center;gap:10px;flex-shrink:0;">
        <!-- Avatar de l'autre -->
        <div style="position:relative;display:flex;flex-direction:column;align-items:center;gap:2px;">
          <div id="dmHeaderAvatarOther" style="width:30px;height:30px;border-radius:50%;background:var(--s2);border:2px solid var(--border);overflow:hidden;opacity:0.38;"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;object-fit:cover;display:block;border-radius:50%;"></div>
          <div id="dmHeaderDotOther" style="width:7px;height:7px;border-radius:50%;background:#555;position:absolute;bottom:0;right:0;border:1.5px solid var(--bg);"></div>
        </div>
        <!-- Avatar de soi -->
        <div style="position:relative;display:flex;flex-direction:column;align-items:center;gap:2px;">
          <div id="dmHeaderAvatarSelf" style="width:34px;height:34px;border-radius:50%;background:var(--s2);border:2px solid var(--border);overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;object-fit:cover;display:block;border-radius:50%;"></div>
          <div id="dmHeaderDotSelf" style="width:7px;height:7px;border-radius:50%;background:#22c55e;box-shadow:0 0 4px rgba(34,197,94,0.8);position:absolute;bottom:0;right:0;border:1.5px solid var(--bg);"></div>
        </div>
      </div>
      <!-- Bouton thÃ¨me -->
      <button class="dm-topbar-theme" onclick="applyThemeToggle()" title="ThÃ¨me">
        <svg id="dmThemeIconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
        <svg id="dmThemeIconSun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      </button>
    </div>
  </div>

  <!-- WRAPPER DE TRANSITION â€” clip pour animations slide -->
  <div id="dmTransitionWrap" style="flex:1;position:relative;overflow:hidden;width:100%;min-height:0;">

  <!-- Ã‰CRAN 1 : ACCUEIL -->
  <div class="dm-screen" id="dmHomeScreen" style="display:none">
    <!-- Pill profil supprimÃ©e â€” les avatars sont dans la topbar -->
    <div id="dmTopbarProfile" style="display:none;"></div>

    <!-- Logo supprimÃ© â€” fenÃªtre parasite purgÃ©e -->
    <div id="dmHomeLogo" style="display:none;"></div>

    <!-- Ã‰cran conv : header style YAM + carte Nous -->
    <div class="dm-home-inner dm-home-conv-screen" id="dmHomeConv" style="display:flex;">

      <!-- Header grand style YAM -->
      <div class="dm-yam-header">
        <div class="hdr-tag">You And Me</div>
        <div class="hdr-name">Messages</div>
        <div class="hdr-sub">
          <svg width="6" height="6" viewBox="0 0 6 6" fill="none"><circle cx="3" cy="3" r="3" fill="var(--green)"/></svg>
          InstaLove âœ¨
        </div>
      </div>

      <!-- Label section -->
      <div style="padding:0 16px 10px;font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;">Conversations</div>

      <!-- Carte Nous -->
      <div class="dm-home-conv" onclick="dmOpenMessaging()">
        <div class="dm-home-conv-avatars">
          <div class="dm-avatar dm-avatar-girl" style="background:none;overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
          <div class="dm-avatar dm-avatar-boy" style="background:none;overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_boy.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
        </div>
        <div class="dm-home-conv-info">
          <div class="dm-home-conv-name">Nous â¤ï¸</div>
          <div class="dm-home-conv-preview" id="dmHomePreview">Chargementâ€¦</div>
        </div>
        <div class="dm-home-conv-meta">
          <div class="dm-home-conv-time" id="dmHomeTime"></div>
          <div class="dm-home-conv-badge" id="dmHomeBadge" style="display:none"></div>
        </div>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color:var(--muted);flex-shrink:0"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div class="dm-home-footer">ğŸ”’ Espace privÃ©</div>
    </div>

  </div>

  </div><!-- /dmTransitionWrap -->

  <!-- Ã‰CRAN 2 : CHOIX IDENTITÃ‰ (modal overlay) -->
  <div class="dm-id-overlay" id="dmIdentityScreen" style="display:none" onclick="dmCloseIdentityIfOutside(event)">
    <div class="dm-id-modal" id="dmIdModal">
      <div class="dm-id-title">C&#39;est qui ?</div>
      <div class="dm-id-sub">Ton identitÃ© dans la conversation</div>
      <div class="dm-id-btns">
        <button id="dmIdBtnGirl" class="dm-id-btn dm-id-girl" onclick="dmSetIdentity('girl')">
          <div class="dm-avatar dm-avatar-girl dm-id-av" style="background:none;overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
          <span class="dm-id-name" id="dmIdNameGirl">Elle</span>
          <span class="dm-id-sub2">Elle ğŸ’•</span>
        </button>
        <button id="dmIdBtnBoy" class="dm-id-btn dm-id-boy" onclick="dmSetIdentity('boy')">
          <div class="dm-avatar dm-avatar-boy dm-id-av" style="background:none;overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_boy.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
          <span class="dm-id-name" id="dmIdNameBoy">Lui</span>
          <span class="dm-id-sub2">Lui ğŸ’™</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Ã‰CRAN 3 : CHAT -->
  <div class="dm-screen dm-chat-screen" id="dmChatScreen" style="display:none">
    <div class="dm-messages" id="dmMessages"></div>
    <div id="dmReplyBar">
      <span class="reply-bar-icon">â†©ï¸</span>
      <span class="reply-bar-text" id="dmReplyBarText">RÃ©pondre Ã â€¦</span>
      <button class="reply-bar-close" onclick="dmCancelReply()">âœ•</button>
    </div>
    <div class="dm-input-bar">
      <div class="dm-input-wrap">
        <button class="dm-emoji-btn" id="dmEmojiBtn">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        </button>
        <div class="dm-emoji-picker" id="dmEmojiPicker">
          <span>â¤ï¸</span><span>ğŸ˜</span><span>ğŸ¥º</span><span>ğŸ˜‚</span>
          <span>ğŸ”¥</span><span>âœ¨</span><span>ğŸ’€</span><span>ğŸ«¶</span>
          <span>ğŸ˜­</span><span>ğŸ’…</span><span>ğŸ¥°</span><span>ğŸ˜ˆ</span>
        </div>
        <div class="dm-rec-indicator" id="dmRecIndicator">
          <div class="dm-rec-dot"></div> <span id="dmRecTime">0:00</span>
        </div>
        <input type="text" class="dm-input" id="dmInput" placeholder="Messageâ€¦" autocomplete="off" maxlength="500">
        <button class="dm-mic-btn" id="dmMicBtn" title="Maintenir pour enregistrer">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1a4 4 0 0 1 4 4v6a4 4 0 0 1-8 0V5a4 4 0 0 1 4-4zm-1 16.93A8.001 8.001 0 0 1 4 10H2a10 10 0 0 0 9 9.93V22h2v-2.07A10 10 0 0 0 22 10h-2a8 8 0 0 1-7 7.93V17.93z"/></svg>
        </button>
        <button class="dm-send-btn" id="dmSendBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
    </div>
  </div>

</div>

<div id="gamesView">
  <div class="gv-header">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
      <div class="gv-back" onclick="closeGames()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour</div>
      <button class="dm-topbar-theme" onclick="applyThemeToggle()" title="ThÃ¨me">
        <svg id="gvThemeIconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
        <svg id="gvThemeIconSun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      </button>
    </div>
    <div class="gv-title">Jeux ğŸ®</div>
    <div class="gv-sub">Pour se dÃ©tendre ensemble</div>
  </div>
  <div class="gv-game-list">
    <div class="gv-game-card" onclick="openMemoryGame()">
      <div class="gv-game-card-icon">ğŸ´</div>
      <div class="gv-game-card-info">
        <div class="gv-game-card-name">Jeu de mÃ©moire</div>
        <div class="gv-game-card-desc">Retrouve toutes les paires â€” moins de coups = meilleur score</div>
      </div>
      <div class="gv-game-card-arrow">â€º</div>
    </div>
    <div class="gv-game-card" onclick="openPenduGame()">
      <div class="gv-game-card-icon">ğŸª“</div>
      <div class="gv-game-card-info">
        <div class="gv-game-card-name">Le Pendu</div>
        <div class="gv-game-card-desc">Devine le mot lettre par lettre avant qu'il soit trop tard</div>
      </div>
      <div class="gv-game-card-arrow">â€º</div>
    </div>
    <div class="gv-game-card" onclick="openPuzzleGame()">
      <div class="gv-game-card-icon">ğŸ§©</div>
      <div class="gv-game-card-info">
        <div class="gv-game-card-name">Puzzle Photo</div>
        <div class="gv-game-card-desc">Reconstitue l'image en moins de coups possible</div>
      </div>
      <div class="gv-game-card-arrow">â€º</div>
    </div>
    <div class="gv-game-card" onclick="openSnakeGame()">
      <div class="gv-game-card-icon">ğŸ</div>
      <div class="gv-game-card-info">
        <div class="gv-game-card-name">Snake</div>
        <div class="gv-game-card-desc">Mange les cÅ“urs, Ã©vite les murs â€” bats le score de l'autre</div>
      </div>
      <div class="gv-game-card-arrow">â€º</div>
    </div>
    <div class="gv-game-card" onclick="openSkyjoLock()" id="skyjoCard" style="position:relative;overflow:hidden;">
      <div class="gv-game-card-icon">ğŸƒ</div>
      <div class="gv-game-card-info">
        <div class="gv-game-card-name">Skyjo <span style="font-size:9px;font-weight:700;letter-spacing:1px;color:#a78bfa;background:rgba(167,139,250,0.15);border:1px solid rgba(167,139,250,0.35);border-radius:4px;padding:2px 6px;vertical-align:middle;">ğŸ”’ BÃŠTA</span></div>
        <div class="gv-game-card-desc">Le jeu de cartes en duo â€” objectif : le moins de points possible !</div>
      </div>
      <div class="gv-game-card-arrow">â€º</div>
    </div>
  </div>
</div>

<!-- â•â•â•â• VUE JEU DE MÃ‰MOIRE â•â•â•â• -->
<div id="memoryView">
  <div class="game-view-header">
    <div class="game-view-back" onclick="closeMemoryGame()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour aux jeux</div>
    <div class="game-view-title">Jeu de mÃ©moire ğŸ´</div>
  </div>
  <div class="game-view-body">

    <!-- Ã‰TAPE 1 : Choix du joueur -->
    <div class="gender-select-screen" id="memoryGenderScreen">
      <div class="memory-start-icon">ğŸ´</div>
      <div class="gender-select-title">Qui joue ?</div>
      <div class="gender-select-sub">Choisis ton identitÃ© pour sauvegarder ton score</div>
      <div class="gender-select-btns">
        <button class="gender-select-btn" id="memGenderGirl" onclick="memorySelectGender('girl')">
          <span class="gender-select-icon girl-dot"></span>
          <span id="memGenderGirlName">Elle</span>
        </button>
        <button class="gender-select-btn" id="memGenderBoy" onclick="memorySelectGender('boy')">
          <span class="gender-select-icon boy-dot"></span>
          <span id="memGenderBoyName">Lui</span>
        </button>
      </div>
    </div>

    <!-- Ã‰TAPE 2 : PrÃªt Ã  jouer -->
    <div class="memory-start-screen" id="memoryStartScreen" style="display:none">
      <div class="memory-start-icon" id="memoryStartEmoji">ğŸ´</div>
      <div class="memory-start-title" id="memoryStartTitle">Jeu de mÃ©moire</div>
      <div class="memory-start-sub">Retrouve toutes les paires d'Ã©mojis cachÃ©es. Moins de coups = meilleur score !</div>
      <button class="memory-start-btn" onclick="memoryLaunch()">â–¶ Jouer</button>
      <div style="font-size:11px;color:var(--muted);cursor:pointer;margin-top:-4px;" onclick="memoryBackToGender()">â† Changer de joueur</div>
    </div>

    <!-- JEU EN COURS -->
    <div id="memoryGameArea" style="display:none">
      <div class="memory-header">
        <div class="memory-stats">
          <div class="memory-stat"><span class="memory-stat-num" id="memScore">0</span><span class="memory-stat-lbl">Paires</span></div>
          <div class="memory-stat"><span class="memory-stat-num" id="memMoves">0</span><span class="memory-stat-lbl">Coups</span></div>
          <div class="memory-stat"><span class="memory-stat-num" id="memTime">0s</span><span class="memory-stat-lbl">Temps</span></div>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="memory-restart-btn" onclick="memoryRestart()">ğŸ”„</button>
          <button class="memory-restart-btn" onclick="memoryQuit()" style="color:var(--muted);border-color:var(--border)">âœ• Quitter</button>
        </div>
      </div>
      <div class="memory-grid" id="memoryGrid"></div>
      <div class="memory-win" id="memoryWin">
        <span class="memory-win-emoji">ğŸ†</span>
        <div class="memory-win-title" id="memoryWinTitle"></div>
        <div class="memory-win-sub" id="memoryWinSub"></div>
        <button class="memory-win-replay" onclick="memoryRestart()">Rejouer ğŸ”„</button>
      </div>
    </div>

    <!-- CLASSEMENT â€” intÃ©grÃ© dans la vue du jeu -->
    <div class="leaderboard-wrap" id="memoryLeaderboard">
      <div class="leaderboard-title">Classement</div>
      <div class="leaderboard-tabs">
        <div class="lb-tab active-all" id="lbTabAll" onclick="lbSetTab('all')">Tous</div>
        <div class="lb-tab" id="lbTabGirl" onclick="lbSetTab('girl')">Elle â™€</div>
        <div class="lb-tab" id="lbTabBoy" onclick="lbSetTab('boy')">Lui â™‚</div>
      </div>
      <div id="lbList"><div class="lb-loading"><span class="spinner"></span> Chargement...</div></div>
    </div>

  </div>
</div>


<!-- â•â•â•â• VUE PENDU â•â•â•â• -->
<div id="penduView">
  <div class="game-view-header">
    <div class="game-view-back" onclick="closePenduGame()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour aux jeux</div>
    <div class="game-view-title">Le Pendu ğŸª“</div>
  </div>
  <div class="game-view-body">
    <div class="gender-select-screen" id="penduGenderScreen">
      <div style="font-size:48px">ğŸª“</div>
      <div class="gender-select-title">Qui joue ?</div>
      <div class="gender-select-sub">Choisis ton identitÃ© pour le classement</div>
      <div class="gender-select-btns">
        <button class="gender-select-btn" id="penduGenderGirl" onclick="penduSelectGender('girl')"><span class="gender-select-icon girl-dot"></span><span id="penduGenderGirlName">Elle</span></button>
        <button class="gender-select-btn" id="penduGenderBoy"  onclick="penduSelectGender('boy')"><span class="gender-select-icon boy-dot"></span><span id="penduGenderBoyName">Lui</span></button>
      </div>
    </div>
    <div id="penduGameArea" style="display:none">
      <svg class="pendu-svg" width="160" height="160" viewBox="0 0 160 160" id="penduSvg">
        <line x1="20" y1="155" x2="140" y2="155" stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
        <line x1="50" y1="155" x2="50" y2="10"  stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
        <line x1="50" y1="10"  x2="110" y2="10" stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
        <line x1="110" y1="10" x2="110" y2="30" stroke="var(--border)" stroke-width="3" stroke-linecap="round" id="ph-rope"/>
        <circle cx="110" cy="44" r="14" stroke="#3d9bd4" stroke-width="2.5" fill="none" id="ph-head" style="display:none"/>
        <line x1="110" y1="58" x2="110" y2="98" stroke="#3d9bd4" stroke-width="2.5" stroke-linecap="round" id="ph-body" style="display:none"/>
        <line x1="110" y1="68" x2="90"  y2="85" stroke="#3d9bd4" stroke-width="2.5" stroke-linecap="round" id="ph-arm1" style="display:none"/>
        <line x1="110" y1="68" x2="130" y2="85" stroke="#3d9bd4" stroke-width="2.5" stroke-linecap="round" id="ph-arm2" style="display:none"/>
        <line x1="110" y1="98" x2="92"  y2="125" stroke="#3d9bd4" stroke-width="2.5" stroke-linecap="round" id="ph-leg1" style="display:none"/>
        <line x1="110" y1="98" x2="128" y2="125" stroke="#3d9bd4" stroke-width="2.5" stroke-linecap="round" id="ph-leg2" style="display:none"/>
      </svg>
      <div class="pendu-errors" id="penduErrors">0 / 7 erreurs</div>
      <div class="pendu-theme-wrap" id="penduThemeWrap"></div>
      <div class="pendu-hint" id="penduHint"></div>
      <div class="pendu-word" id="penduWord"></div>
      <div class="pendu-keyboard" id="penduKeyboard"></div>
      <div class="pendu-result" id="penduResult" style="display:none">
        <span class="pendu-result-emoji" id="penduResultEmoji"></span>
        <div id="penduResultMsg" style="font-size:14px;color:var(--sub);margin-bottom:8px"></div>
        <div class="pendu-word-reveal" id="penduWordReveal"></div>
        <button class="game-start-btn" style="margin-top:14px" onclick="penduNextWord()">Mot suivant â†’</button>
      </div>
    </div>
    <div class="leaderboard-wrap" id="penduLeaderboard" style="margin-top:20px">
      <div class="leaderboard-title">Classement</div>
      <div class="leaderboard-tabs">
        <div class="lb-tab active-all" id="plbTabAll"  onclick="plbSetTab('all')">Tous</div>
        <div class="lb-tab"            id="plbTabGirl" onclick="plbSetTab('girl')">Elle â™€</div>
        <div class="lb-tab"            id="plbTabBoy"  onclick="plbSetTab('boy')">Lui â™‚</div>
      </div>
      <div id="plbList"><div class="lb-loading">Chargement...</div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â• VUE PUZZLE â•â•â•â• -->
<div id="puzzleView">
  <div class="game-view-header">
    <div class="game-view-back" onclick="closePuzzleGame()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour aux jeux</div>
    <div class="game-view-title">Puzzle Photo ğŸ§©</div>
  </div>
  <div class="game-view-body">
    <div class="gender-select-screen" id="puzzleGenderScreen">
      <div style="font-size:48px">ğŸ§©</div>
      <div class="gender-select-title">Qui joue ?</div>
      <div class="gender-select-sub">Choisis ton identitÃ© pour le classement</div>
      <div class="gender-select-btns">
        <button class="gender-select-btn" id="puzzleGenderGirl" onclick="puzzleSelectGender('girl')"><span class="gender-select-icon girl-dot"></span><span id="puzzleGenderGirlName">Elle</span></button>
        <button class="gender-select-btn" id="puzzleGenderBoy"  onclick="puzzleSelectGender('boy')"><span class="gender-select-icon boy-dot"></span><span id="puzzleGenderBoyName">Lui</span></button>
      </div>
    </div>
    <div id="puzzleGameArea" style="display:none">
      <div style="text-align:center;margin-bottom:8px">
        <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:6px">Taille</div>
        <div class="puzzle-size-btns">
          <button class="puzzle-size-btn active" onclick="puzzleSetSize(3,this)">3Ã—3</button>
          <button class="puzzle-size-btn"        onclick="puzzleSetSize(4,this)">4Ã—4</button>
          <button class="puzzle-size-btn"        onclick="puzzleSetSize(5,this)">5Ã—5</button>
        </div>
        <div class="puzzle-moves" id="puzzleMoves">0 Ã©changes</div>
      </div>
      <div class="puzzle-grid" id="puzzleGrid"></div>
      <div style="text-align:center;margin-top:10px;display:flex;gap:8px;justify-content:center">
        <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
          <button class="game-start-btn" onclick="puzzleInit()">ğŸ”€ MÃ©langer</button>
          <button class="game-start-btn" onclick="puzzleReplay()" style="background:rgba(91,156,246,0.15);color:#5b9cf6;border-color:rgba(91,156,246,0.4)">ğŸ² Autre puzzle</button>
        </div>
        <button class="game-start-btn" style="background:rgba(0,201,167,0.12);color:var(--green);border-color:rgba(0,201,167,0.35)" onclick="puzzleShowPreview()">ğŸ‘ AperÃ§u</button>
      </div>
      <div id="puzzleWin" style="display:none;text-align:center;padding:20px 0">
        <div style="font-size:44px">ğŸ†</div>
        <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--text);margin:8px 0" id="puzzleWinTitle"></div>
        <div style="font-size:13px;color:var(--sub)" id="puzzleWinSub"></div>
        <button class="game-start-btn" style="margin-top:14px" onclick="puzzleReplay()">Rejouer ğŸ”€</button>
      </div>
    </div>
    <div class="leaderboard-wrap" id="puzzleLeaderboard" style="margin-top:20px">
      <div class="leaderboard-title">Classement</div>
      <div class="leaderboard-tabs">
        <div class="lb-tab active-all" id="zplbTabAll"  onclick="zplbSetTab('all')">Tous</div>
        <div class="lb-tab"            id="zplbTabGirl" onclick="zplbSetTab('girl')">Elle â™€</div>
        <div class="lb-tab"            id="zplbTabBoy"  onclick="zplbSetTab('boy')">Lui â™‚</div>
      </div>
      <div id="zplbList"><div class="lb-loading">Chargement...</div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â• VUE SNAKE â•â•â•â• -->
<div id="snakeView">
  <div class="game-view-header">
    <div class="game-view-back" onclick="closeSnakeGame()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour aux jeux</div>
    <div class="game-view-title">Snake ğŸ</div>
  </div>
  <div class="game-view-body">
    <div class="gender-select-screen" id="snakeGenderScreen">
      <div style="font-size:48px">ğŸ</div>
      <div class="gender-select-title">Qui joue ?</div>
      <div class="gender-select-sub">Choisis ton identitÃ© pour le classement</div>
      <div class="gender-select-btns">
        <button class="gender-select-btn" id="snakeGenderGirl" onclick="snakeSelectGender('girl')"><span class="gender-select-icon girl-dot"></span><span id="snakeGenderGirlName">Elle</span></button>
        <button class="gender-select-btn" id="snakeGenderBoy"  onclick="snakeSelectGender('boy')"><span class="gender-select-icon boy-dot"></span><span id="snakeGenderBoyName">Lui</span></button>
      </div>
    </div>
    <div id="snakeGameArea" style="display:none">
      <div class="snake-score-bar">
        <div class="snake-stat"><span class="snake-stat-num" id="snakeScore">0</span><span class="snake-stat-lbl">Score</span></div>
        <div class="snake-stat"><span class="snake-stat-num" id="snakeBest">0</span><span class="snake-stat-lbl">Meilleur</span></div>
      </div>
      <div class="snake-wrap">
        <canvas id="snakeCanvas" width="340" height="340"></canvas>
        <div class="snake-overlay" id="snakeOverlay">
          <div class="snake-overlay-title" id="snakeOverlayTitle">Snake ğŸ</div>
          <div class="snake-overlay-sub"  id="snakeOverlaySub">Mange les ğŸ’• sans te mordre la queue</div>
          <button class="snake-overlay-btn" onclick="snakeStart()">â–¶ Jouer</button>
        </div>
      </div>
      <div class="snake-dpad">
        <div class="snake-dpad-row">
          <div class="snake-btn" ontouchstart="snakeDir(0,-1);event.preventDefault()" onclick="snakeDir(0,-1)">â–²</div>
        </div>
        <div class="snake-dpad-row">
          <div class="snake-btn" ontouchstart="snakeDir(-1,0);event.preventDefault()" onclick="snakeDir(-1,0)">â—€</div>
          <div class="snake-btn snake-btn-center"></div>
          <div class="snake-btn" ontouchstart="snakeDir(1,0);event.preventDefault()" onclick="snakeDir(1,0)">â–¶</div>
        </div>
        <div class="snake-dpad-row">
          <div class="snake-btn" ontouchstart="snakeDir(0,1);event.preventDefault()" onclick="snakeDir(0,1)">â–¼</div>
        </div>
      </div>
    </div>
    <div class="leaderboard-wrap" id="snakeLeaderboard" style="margin-top:20px">
      <div class="leaderboard-title">Classement</div>
      <div class="leaderboard-tabs">
        <div class="lb-tab active-all" id="slbTabAll"  onclick="slbSetTab('all')">Tous</div>
        <div class="lb-tab"            id="slbTabGirl" onclick="slbSetTab('girl')">Elle â™€</div>
        <div class="lb-tab"            id="slbTabBoy"  onclick="slbSetTab('boy')">Lui â™‚</div>
      </div>
      <div id="slbList"><div class="lb-loading">Chargement...</div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â• VUE SKYJO â•â•â•â• -->
<div id="skyjoView">
  <div class="game-view-header">
    <div class="game-view-back" onclick="closeSkyjoGame()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour aux jeux</div>
    <div class="game-view-title">Skyjo ğŸƒ</div>
    <button id="skyjoAbandonBtn" onclick="skyjoAbandon()" style="display:none;padding:4px 10px;background:rgba(239,83,80,0.12);color:#ef5350;border:1px solid rgba(239,83,80,0.35);border-radius:6px;font-size:11px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;">Abandon</button>
  </div>
  <div class="game-view-body" style="padding:0;position:relative;">

    <!-- Ã©cran lock supprimÃ© â€” accÃ¨s par profil uniquement -->

    <!-- Ã‰CRAN ATTENTE (stand-by, en attente de l'autre joueur) -->
    <div id="skyjoWaitScreen" style="display:none;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;gap:20px;text-align:center;">
      <div style="font-size:52px">â³</div>
      <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--text)">En attente...</div>
      <div id="skyjoWaitMsg" style="font-size:14px;color:var(--sub);max-width:280px;line-height:1.6"></div>
      <div style="display:flex;gap:12px;align-items:center;margin-top:4px;">
        <div class="skyjo-player-bubble" id="skyjoWaitBubbleGirl">
          <img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;display:block;">
          <div style="font-size:10px;font-weight:700;color:var(--sub)" id="skyjoWaitNameGirl">Elle</div>
          <div class="skyjo-presence-dot" id="skyjoPresenceGirl"></div>
        </div>
        <div style="font-size:24px;color:var(--muted)">vs</div>
        <div class="skyjo-player-bubble" id="skyjoWaitBubbleBoy">
          <img class="yam-av-img" src="assets/images/profil_boy.png" alt="" style="width:36px;height:36px;border-radius:50%;object-fit:cover;display:block;">
          <div style="font-size:10px;font-weight:700;color:var(--sub)" id="skyjoWaitNameBoy">Lui</div>
          <div class="skyjo-presence-dot" id="skyjoPresenceBoy"></div>
        </div>
      </div>
      <div style="font-size:11px;color:var(--muted);margin-top:4px">Le jeu se lance automatiquement quand vous Ãªtes tous les deux connectÃ©s ğŸ®</div>
      <button onclick="skyjoLeaveWait()" style="margin-top:8px;padding:10px 24px;background:var(--s2);color:var(--sub);border:1px solid var(--border);border-radius:50px;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif;cursor:pointer;">Annuler</button>
    </div>

    <!-- Overlay chargement pendant RPC -->
    <div id="sjLoadingOverlay"><div id="sjLoadingDot"></div></div>

    <!-- ZONE DE JEU -->
    <div id="skyjoGameArea" style="position:relative;">

      <!-- BanniÃ¨re de tour + barre timer collÃ©e dessous -->
      <div id="skyjoTurnBanner" class="skyjo-turn-banner their-turn" style="position:relative;overflow:hidden;">
        <span id="skyjoTurnBannerText">â³ â€¦</span>
        <div id="sjTimerBar"><div id="sjTimerBarFill"></div></div>
      </div>

      <!-- Terrain vertical -->
      <div id="skyjoPlayField">

        <!-- â•â•â• ADVERSAIRE (haut) â•â•â• -->
        <div class="skyjo-player-zone zone-opp">
          <div class="skyjo-manche-badge" style="display:flex;flex-direction:column;align-items:flex-end;gap:1px;">
            <span>Manche <span id="skyjoRound">1</span></span>
            <span id="skyjoLastRoundBadge" style="display:none;font-size:8px;font-weight:700;color:var(--muted);white-space:nowrap;"></span>
          </div>
          <div class="skyjo-player-info">
            <div class="skyjo-avatar" id="skyjoAvatarOpp" style="overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
            <span class="skyjo-player-name" id="skyjoOpponentLabel">Elle</span>
            <div id="skyjoOppPresenceDot" style="width:8px;height:8px;border-radius:50%;background:#555;transition:background 0.3s,box-shadow 0.3s;flex-shrink:0;" title="Hors ligne"></div>
            <span class="skyjo-player-score-badge" id="skyjoScoreGirl">0</span>
          </div>
          <div style="display:flex;align-items:center;gap:6px;">
            <!-- Carte en main adversaire (visible en live) -->
            <div id="skyjoOppHeldWrap">
              <div id="skyjoOppHeldLabel">En main</div>
              <div id="skyjoOppHeldCard" class="skyjo-card skyjo-card-held"></div>
            </div>
            <div id="skyjoOppTotal" class="sj-total-badge opp">â€”</div>
            <div class="skyjo-grid" id="skyjoOpponentGrid"></div>
          </div>
        </div>

        <!-- â•â•â• ZONE CENTRALE â•â•â• -->
        <div id="skyjoMidZone">

          <!-- Carte en main (Ã  gauche, cachÃ©e si absent) -->
          <div id="skyjoHeldCardWrap">
            <div id="skyjoHeldLabel">En main</div>
            <div id="skyjoHeldCard" class="skyjo-card skyjo-card-held"></div>
            <button id="skyjoDiscardBtn" onclick="skyjoDiscardHeld()">ğŸ—‘ DÃ©fausser</button>
          </div>

          <!-- Pioche -->
          <div class="skyjo-pile-slot" id="skyjoDrawSlot">
            <div class="skyjo-pile-label">Pioche</div>
            <div id="skyjoDeckCard" class="skyjo-card skyjo-card-back" onclick="skyjoDrawFromDeck()" style="cursor:pointer;"></div>
            <div id="skyjoDrawPileCount">â€”</div>
          </div>

          <!-- DÃ©fausse -->
          <div class="skyjo-pile-slot">
            <div class="skyjo-pile-label">DÃ©fausse</div>
            <div id="skyjoDiscardCard" class="skyjo-card skyjo-card-hidden" onclick="skyjoDrawFromDiscard()" style="cursor:pointer;">â€”</div>
          </div>

          <!-- Badge de tour â€” Ã  droite de la dÃ©fausse -->
          <div id="skyjoTurnBadgeSlot"></div>

        </div>

        <!-- â•â•â• MOI (bas) â•â•â• -->
        <div class="skyjo-player-zone zone-me">
          <div class="skyjo-player-info">
            <div class="skyjo-avatar" id="skyjoAvatarMe" style="overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_boy.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
            <span class="skyjo-player-name" id="skyjoMyLabel">Lui</span>
            <span class="skyjo-player-score-badge" id="skyjoScoreBoy">0</span>
          </div>
          <div style="display:flex;align-items:center;gap:6px;">
            <div id="skyjoMyTotal" class="sj-total-badge mine">â€”</div>
            <div class="skyjo-grid" id="skyjoMyGrid"></div>
          </div>
        </div>

      </div>

      <!-- Message contextuel bas d'Ã©cran -->
      <div id="skyjoPhaseMsg"></div>

      <!-- â•â•â• SYSTÃˆME DE RÃ‰ACTIONS â•â•â• -->
      <!-- Bouton rÃ©action (bas gauche) -->
      <button id="sjReactBtn" onclick="skyjoToggleReactionPicker(event)" title="RÃ©actions">
        <img src="assets/images/reaction_1.png" alt="ğŸ˜„" id="sjReactBtnImg">
      </button>

      <!-- Picker vertical (s'ouvre au-dessus du bouton) -->
      <div id="sjReactPicker">
        <button class="sj-react-option" onclick="skyjoSendReaction(1)"><img src="assets/images/reaction_1.png" alt="ğŸ˜„"></button>
        <button class="sj-react-option" onclick="skyjoSendReaction(2)"><img src="assets/images/reaction_2.png" alt="ğŸ˜Š"></button>
        <button class="sj-react-option" onclick="skyjoSendReaction(3)"><img src="assets/images/reaction_3.png" alt="ğŸ˜"></button>
        <button class="sj-react-option" onclick="skyjoSendReaction(4)"><img src="assets/images/reaction_4.png" alt="ğŸ˜˜"></button>
        <button class="sj-react-option" onclick="skyjoSendReaction(5)"><img src="assets/images/reaction_5.png" alt="ğŸ˜ˆ"></button>
        <button class="sj-react-option" onclick="skyjoSendReaction(6)"><img src="assets/images/reaction_6.png" alt="ğŸ˜¢"></button>
        <button class="sj-react-option" onclick="skyjoSendReaction(7)"><img src="assets/images/reaction_7.png" alt="ğŸ˜"></button>
      </div>

      <!-- Ma bulle de rÃ©action (bas gauche, au-dessus du bouton) -->
      <div id="sjMyReactionBubble" class="sj-reaction-bubble sj-bubble-me">
        <img src="" alt="">
      </div>

      <!-- Bulle rÃ©action adverse (haut gauche, zone adversaire) -->
      <div id="sjOppReactionBubble" class="sj-reaction-bubble sj-bubble-opp">
        <img src="" alt="">
      </div>

    </div>

    <!-- FIN DE MANCHE -->
    <div id="skyjoRoundEnd" style="display:none;position:absolute;inset:0;z-index:100;flex-direction:column;align-items:center;justify-content:center;background:var(--bg);gap:20px;padding:24px;text-align:center;overflow:hidden;">
      <div style="font-size:52px" id="skyjoRoundEndEmoji">ğŸ†</div>
      <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--text);line-height:1.3" id="skyjoRoundEndTitle"></div>
      <div style="font-size:12px;color:var(--muted);font-weight:600;letter-spacing:0.5px" id="skyjoRoundEndSub"></div>
      <!-- Scores de la manche -->
      <div style="display:flex;gap:12px;width:100%;max-width:280px;">
        <div style="flex:1;background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:16px 12px;text-align:center;">
          <div id="skyjoRoundLabelLeft" style="font-size:11px;color:var(--muted);margin-bottom:4px"><span id="skyjoRoundNameLeft">Elle</span></div>
          <div style="font-size:13px;color:var(--muted);margin-bottom:2px">Cette manche</div>
          <div style="font-size:28px;font-weight:800;color:var(--text)" id="skyjoRoundScoreGirl">0</div>
          <div style="font-size:11px;color:var(--muted);margin-top:6px">Total</div>
          <div style="font-size:16px;font-weight:700;color:var(--green)" id="skyjoTotalScoreGirl">0</div>
        </div>
        <div style="flex:1;background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:16px 12px;text-align:center;">
          <div id="skyjoRoundLabelRight" style="font-size:11px;color:var(--muted);margin-bottom:4px"><span id="skyjoRoundNameRight">Lui</span></div>
          <div style="font-size:13px;color:var(--muted);margin-bottom:2px">Cette manche</div>
          <div style="font-size:28px;font-weight:800;color:var(--text)" id="skyjoRoundScoreBoy">0</div>
          <div style="font-size:11px;color:var(--muted);margin-top:6px">Total</div>
          <div style="font-size:16px;font-weight:700;color:var(--green)" id="skyjoTotalScoreBoy">0</div>
        </div>
      </div>
      <!-- Bouton visible pour les deux, mais seul girl dÃ©clenche -->
      <div id="skyjoNextRoundWrap" style="display:flex;flex-direction:column;align-items:center;gap:10px;width:100%;max-width:280px;">
        <button id="skyjoNextRoundBtn" onclick="skyjoNextRound()" style="width:100%;padding:14px 0;background:var(--green);color:#000;font-weight:700;font-size:15px;font-family:'DM Sans',sans-serif;border:none;border-radius:50px;cursor:pointer;">Manche suivante â†’</button>
        <div id="skyjoWaitNextMsg" style="display:none;font-size:12px;color:var(--muted);font-weight:600;">â³ En attente que l'autre lance la mancheâ€¦</div>
      </div>
    </div>

    <!-- FIN DE PARTIE -->
    <div id="skyjoGameEnd" style="display:none;position:absolute;inset:0;z-index:100;flex-direction:column;align-items:center;justify-content:center;background:var(--bg);gap:20px;padding:24px;text-align:center;overflow:hidden;">
      <div style="font-size:72px" id="skyjoGameEndEmoji">ğŸ†</div>
      <div style="font-family:'Playfair Display',serif;font-size:24px;font-weight:700;color:var(--text)" id="skyjoGameEndTitle">Victoire !</div>
      <div style="font-size:13px;color:var(--muted)" id="skyjoGameEndSub"></div>
      <!-- Scores finaux -->
      <div style="display:flex;gap:12px;width:100%;max-width:280px;">
        <div style="flex:1;background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:16px 12px;text-align:center;">
          <div id="skyjoFinalEmojiLeft" style="width:36px;height:36px;border-radius:50%;overflow:hidden;margin:0 auto 4px;"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;object-fit:cover;display:block;"></div>
          <div id="skyjoFinalLabelLeft" style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:6px"><span id="skyjoFinalNameLeft">Elle</span></div>
          <div style="font-size:32px;font-weight:800;color:var(--text)" id="skyjoFinalScoreGirl">0</div>
          <div style="font-size:10px;color:var(--muted);margin-top:2px">pts</div>
        </div>
        <div style="flex:1;background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:16px 12px;text-align:center;">
          <div id="skyjoFinalEmojiRight" style="width:36px;height:36px;border-radius:50%;overflow:hidden;margin:0 auto 4px;"><img class="yam-av-img" src="assets/images/profil_boy.png" alt="" style="width:100%;height:100%;object-fit:cover;display:block;"></div>
          <div id="skyjoFinalLabelRight" style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:6px"><span id="skyjoFinalNameRight">Lui</span></div>
          <div style="font-size:32px;font-weight:800;color:var(--text)" id="skyjoFinalScoreBoy">0</div>
          <div style="font-size:10px;color:var(--muted);margin-top:2px">pts</div>
        </div>
      </div>
      <div style="font-size:11px;color:var(--muted)">Le score le plus bas gagne ğŸ…</div>
      <div style="display:flex;flex-direction:column;gap:10px;width:100%;max-width:280px;">
        <button onclick="skyjoNewGame()" style="width:100%;padding:14px 0;background:var(--green);color:#000;font-weight:700;font-size:15px;font-family:'DM Sans',sans-serif;border:none;border-radius:50px;cursor:pointer;">Rejouer ğŸ”„</button>
        <button onclick="closeSkyjoGame()" style="width:100%;padding:12px 0;background:var(--s2);color:var(--sub);border:1px solid var(--border);border-radius:50px;font-size:13px;font-family:'DM Sans',sans-serif;cursor:pointer;">Retour aux jeux</button>
      </div>
    </div>

  </div>
</div>

<div id="prankOverlay">
  <div class="prank-emoji">ğŸ¤¡ğŸ‘‰</div>
  <div class="prank-text">Je t'ai prank c'est pas Ã§a haha<br>bon je suis gentil je te donne un indice</div>
  <div class="prank-hint">Ã§a commence par <strong style="color:#3d9bd4">BI</strong> et se termine par <strong style="color:#3d9bd4">TE</strong><br>rÃ©essaie ğŸ˜</div>
  <button class="prank-close" onclick="closePrank()">OK je rÃ©essaie ğŸ”</button>
</div>

<!-- â•â• BÃŠTISES INTERACTIVES â•â• -->
<!-- Menu de choix -->
<div id="prankMenu">
  <div style="width:100%;padding:14px 16px 0;display:flex;align-items:center;justify-content:space-between;">
    <div class="gv-back" onclick="closePrankMenu()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg> Retour</div>
    <button class="dm-topbar-theme" onclick="applyThemeToggle()" title="ThÃ¨me">
      <svg id="pmThemeIconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
      <svg id="pmThemeIconSun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
    </button>
  </div>
  <div class="prank-menu-title">Choisir une bÃªtise ğŸ¤¡</div>
  <div class="prank-menu-sub">SÃ©lectionne ce que <span id="prankVictimName">l'autre</span> devra subir</div>
  <div class="prank-menu-list" id="prankMenuList">
    <div class="prank-menu-item" data-prank-type="shake" onclick="prankSelectType('shake')">
      <div class="prank-menu-item-icon">ğŸ“³</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">L'Ã©cran qui tremble</div><div class="prank-menu-item-desc">Tape 10 fois vite pour l'arrÃªter</div></div>
      <button class="prank-fav-btn" data-prank-type="shake" onclick="prankToggleFav(event,'shake')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="curtain" onclick="prankSelectType('curtain')">
      <div class="prank-menu-item-icon">ğŸŒ§ï¸</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Le rideau d'emojis</div><div class="prank-menu-item-desc">Attrape-les tous pour retrouver le site</div></div>
      <button class="prank-fav-btn" data-prank-type="curtain" onclick="prankToggleFav(event,'curtain')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="intrus" onclick="prankSelectType('intrus')">
      <div class="prank-menu-item-icon">ğŸ‘¾</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">L'intrus qui esquive</div><div class="prank-menu-item-desc">Touche-le 10 fois pour l'Ã©liminer</div></div>
      <button class="prank-fav-btn" data-prank-type="intrus" onclick="prankToggleFav(event,'intrus')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="flip" onclick="prankSelectType('flip')">
      <div class="prank-menu-item-icon">ğŸ”¤</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Le texte Ã  l'envers</div><div class="prank-menu-item-desc">Maintiens le bouton 3s pour corriger</div></div>
      <button class="prank-fav-btn" data-prank-type="flip" onclick="prankToggleFav(event,'flip')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="splash" onclick="prankSelectType('splash')">
      <div class="prank-menu-item-icon">ğŸ¨</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">La flaque de peinture</div><div class="prank-menu-item-desc">Nettoie toutes les taches pour libÃ©rer le site</div></div>
      <button class="prank-fav-btn" data-prank-type="splash" onclick="prankToggleFav(event,'splash')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="lock" onclick="prankSelectType('lock')">
      <div class="prank-menu-item-icon">ğŸ”</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Le cadenas</div><div class="prank-menu-item-desc">Trouve le mot secret pour dÃ©verrouiller</div></div>
      <button class="prank-fav-btn" data-prank-type="lock" onclick="prankToggleFav(event,'lock')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="fog" onclick="prankSelectType('fog')">
      <div class="prank-menu-item-icon">ğŸŒ«ï¸</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Le brouillard</div><div class="prank-menu-item-desc">Tapote 10 fois pour dissiper le flou</div></div>
      <button class="prank-fav-btn" data-prank-type="fog" onclick="prankToggleFav(event,'fog')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="colors" onclick="prankSelectType('colors')">
      <div class="prank-menu-item-icon">ğŸŒˆ</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Les couleurs folles</div><div class="prank-menu-item-desc">Maintiens le bouton pour stabiliser les couleurs</div></div>
      <button class="prank-fav-btn" data-prank-type="colors" onclick="prankToggleFav(event,'colors')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="keyboard" onclick="prankSelectType('keyboard')">
      <div class="prank-menu-item-icon">âŒ¨ï¸</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Le faux clavier</div><div class="prank-menu-item-desc">Tape le mot affichÃ© avec les touches mÃ©langÃ©es</div></div>
      <button class="prank-fav-btn" data-prank-type="keyboard" onclick="prankToggleFav(event,'keyboard')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="target" onclick="prankSelectType('target')">
      <div class="prank-menu-item-icon">ğŸ¯</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">La cible qui esquive</div><div class="prank-menu-item-desc">Clique dessus 10 fois â€” elle accÃ©lÃ¨re !</div></div>
      <button class="prank-fav-btn" data-prank-type="target" onclick="prankToggleFav(event,'target')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="memory" onclick="prankSelectType('memory')">
      <div class="prank-menu-item-icon">ğŸƒ</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Memory express</div><div class="prank-menu-item-desc">MÃ©morise et retrouve les 4 paires</div></div>
      <button class="prank-fav-btn" data-prank-type="memory" onclick="prankToggleFav(event,'memory')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="eyes" onclick="prankSelectType('eyes')">
      <div class="prank-menu-item-icon">ğŸ‘ï¸</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Les yeux qui surveillent</div><div class="prank-menu-item-desc">Fixe chaque paire 5s sans bouger</div></div>
      <button class="prank-fav-btn" data-prank-type="eyes" onclick="prankToggleFav(event,'eyes')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
    <div class="prank-menu-item" data-prank-type="notif" onclick="prankSelectType('notif')">
      <div class="prank-menu-item-icon">ğŸ“±</div>
      <div style="flex:1;min-width:0;"><div class="prank-menu-item-name">Envoyer une notification</div><div class="prank-menu-item-desc">Une notif surprise avec ton message</div></div>
      <button class="prank-fav-btn" data-prank-type="notif" onclick="prankToggleFav(event,'notif')" aria-label="Favori"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
    </div>
  </div>
  <div class="prank-menu-cancel" onclick="closePrankMenu()">Quitter</div>
  <div class="prank-menu-cancel" id="prankCancelAllBtn" onclick="prankCancelAll()" style="color:rgba(255,100,100,0.6);margin-top:0;">ğŸ—‘ï¸ Annuler toutes mes bÃªtises en attente</div>
</div>

<!-- â•â• NOUVELLES BÃŠTISES HTML â•â• -->

<!-- ğŸŒ«ï¸ Brouillard -->
<div id="prankFogOverlay"></div>
<div id="prankFogBanner">ğŸŒ«ï¸ Tapote l'Ã©cran pour dissiper le brouillard â€” <span id="prankFogCount">10</span> restants</div>

<!-- ğŸŒˆ Couleurs folles -->
<div id="prankColorsBanner">
  <div class="prank-colors-label">ğŸŒˆ Maintiens le bouton pour stabiliser les couleurs !</div>
  <div id="prankColorsProgress"><div id="prankColorsProgressBar"></div></div>
  <div id="prankColorsHoldBtn">ğŸ¨</div>
</div>

<!-- âŒ¨ï¸ Faux clavier -->
<div id="prankKeyboard">
  <div class="pkb-word-display" id="pkbWordDisplay"></div>
  <div class="pkb-typed" id="pkbTyped"></div>
  <div class="pkb-hint">âŒ¨ï¸ Les touches sont mÃ©langÃ©esâ€¦ cherche bien !</div>
  <div class="pkb-err" id="pkbErr"></div>
  <div class="pkb-grid" id="pkbGrid"></div>
</div>

<!-- ğŸ¯ Cible -->
<div id="prankTarget"><div class="pt-circle"></div></div>
<div id="prankTargetBanner">ğŸ¯ <span id="prankTargetCount">10</span> touches restantes â€” vise bien !</div>

<!-- ğŸƒ Memory express -->
<div id="prankMemoryOverlay">
  <div class="pmem-title">ğŸƒ Memory express !</div>
  <div class="pmem-sub" id="pmemSub">MÃ©morise les pairesâ€¦ tu as 3 secondes !</div>
  <div class="pmem-grid" id="pmemGrid"></div>
  <div class="pmem-status" id="pmemStatus"></div>
</div>

<!-- ğŸ‘ï¸ Les yeux -->
<div id="prankEyesOverlay"></div>
<div id="prankEyesBanner">ğŸ‘ï¸ Fixe chaque paire d'yeux 5 secondes sans bouger</div>
<div id="prankEyesMessage">
  <div class="prank-eyes-msg-emoji">ğŸ«µğŸ‘€</div>
  <div class="prank-eyes-msg-text">C'est bon j'ai fini de te surveiller ğŸ«µğŸ‘€</div>
</div>

<!-- Overlay verrouillage notif -->
<div id="prankNotifOverlay"></div>

<!-- ğŸ“± Fausse notif -->
<div id="prankNotif" onclick="prankNotifDismiss()">
  <div class="pn-avatar" id="pnAvatar">ğŸ’¬</div>
  <div class="pn-content">
    <div class="pn-header">
      <div class="pn-app" id="pnApp">Messages</div>
      <div class="pn-time">maintenant</div>
    </div>
    <div class="pn-title" id="pnTitle"></div>
    <div class="pn-body" id="pnBody"></div>
  </div>
</div>

<!-- Modal message perso + mot secret si lock -->
<div id="prankMsgModal">
  <div class="prank-msg-box">
    <div class="prank-msg-preview" id="prankMsgPreview">ğŸ“³</div>
    <div class="prank-msg-title" id="prankMsgTitle">Ton message final</div>
    <div id="prankLockWordWrap" style="display:none">
      <input class="prank-msg-input" id="prankLockWord" placeholder="Mot secret Ã  deviner..." autocomplete="off" style="text-align:center;letter-spacing:2px;">
    </div>
    <textarea class="prank-msg-input" id="prankMsgText" rows="3" placeholder="Ex : Haha je t'ai eu ğŸ˜ˆ tu peux pas m'en vouloir..."></textarea>
    <button class="prank-msg-send" onclick="prankSend()">ğŸ’£ Envoyer la bÃªtise</button>
    <div class="prank-msg-cancel" onclick="closePrankMsg()">â† Retour</div>
  </div>
</div>

<!-- Ã‰cran "je t'ai eu" -->
<div id="prankGotcha">
  <div class="gotcha-emoji">ğŸ˜ˆ</div>
  <div class="gotcha-title">T'as Ã©tÃ© eu(e) !</div>
  <div class="gotcha-msg" id="gotchaMsg"></div>
  <button class="gotcha-close" onclick="closeGotcha()">OK j'ai compris ğŸ˜¤</button>
</div>

<!-- BÃªtise : tremblement -->
<div id="prankShakeBanner">
  <div class="prank-shake-label">ğŸ¤¡ Tape l'Ã©cran rapidement pour arrÃªter Ã§a !</div>
  <div class="prank-shake-count" id="prankShakeCount">3 taps</div>
</div>

<!-- BÃªtise : rideau -->
<div id="prankCurtain"></div>
<div id="prankCurtainBanner">ğŸŒ§ï¸ <span id="prankCurtainCount">?</span> emojis restants â€” attrape-les tous !</div>

<!-- BÃªtise : intrus -->
<div id="prankIntrus">ğŸ‘¾</div>
<div id="prankIntrusBanner">ğŸ‘¾ <span id="prankIntrusCount">10</span> touches restantes â€” attrape-le !</div>

<!-- BÃªtise : texte Ã  l'envers -->
<div id="prankFlipBanner">
  <div class="prank-flip-label">ğŸ”¤ Maintiens le bouton pour tout remettre Ã  l'endroit</div>
  <div id="prankFlipHoldWrap">
    <div id="prankFlipProgress"><div id="prankFlipProgressBar"></div></div>
    <div id="prankFlipBtn">ğŸ”„</div>
  </div>
</div>

<!-- BÃªtise : flaque de peinture -->
<div id="prankSplash"></div>
<div id="prankSplashBanner">ğŸ¨ <span id="prankSplashCount">?</span> taches restantes â€” nettoie tout !</div>

<!-- BÃªtise : cadenas -->
<div id="prankLock">
  <div class="prank-lock-icon">ğŸ”</div>
  <div class="prank-lock-title" id="prankLockTitle">AccÃ¨s bloquÃ©</div>
  <div class="prank-lock-sub">Trouve le mot secret pour dÃ©verrouiller</div>
  <input class="prank-lock-input" id="prankLockInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off">
  <button class="prank-lock-btn" onclick="prankCheckLock()">Valider</button>
  <div class="prank-lock-err" id="prankLockErr">âŒ Non ! Essaie encoreâ€¦</div>
</div>

<!-- â•â• SUGGESTION MODALS â•â• -->
<div id="sgAuthModal">
  <div class="memo-auth-inner">
    <div class="memo-auth-icon">ğŸµ</div>
    <div class="memo-auth-title">SuggÃ©rer une musique</div>
    <div class="memo-auth-sub">Entre le code pour dÃ©verrouiller</div>
    <input type="password" class="memo-auth-input" id="sgAuthInput" placeholder="Code..." autocomplete="off">
    <button class="memo-auth-btn" onclick="sgCheckAuth()">Valider</button>
    <div class="memo-auth-err" id="sgAuthErr">âŒ Code incorrect, rÃ©essaie !</div>
    <span class="memo-auth-cancel" onclick="closeSgAuth()">Annuler</span>
  </div>
</div>

<div id="sgEditModal">
  <div class="sg-modal-inner">
    <span class="sg-modal-close" onclick="closeSgEditModal()">âœ•</span>
    <div class="sg-modal-tag">Modifier la suggestion</div>
    <div class="sg-modal-title">Ã‰diter le son âœï¸</div>
    <div class="sg-field-label">Titre de la musique *</div>
    <input type="text" class="sg-input" id="sgEditTitleInput" placeholder="ex: Savage Love" maxlength="80">
    <div class="sg-field-label">Artiste *</div>
    <input type="text" class="sg-input" id="sgEditArtistInput" placeholder="ex: Jawsh 685" maxlength="80">
    <div class="sg-field-label">Note (optionnel)</div>
    <input type="text" class="sg-input" id="sgEditNoteInput" placeholder="ex: trop bonne pour toi ğŸ˜" maxlength="100">
    <div id="sgEditErrMsg" style="display:none;font-size:11px;color:#e05555;margin-bottom:8px;padding:8px 10px;background:rgba(220,50,50,0.07);border-radius:6px;border:1px solid rgba(220,50,50,0.2);word-break:break-all;"></div>
    <button class="sg-modal-save sg-edit-save" onclick="sgEditSave()">Sauvegarder âœ…</button>
  </div>
</div>

<div id="sgModal">
  <div class="sg-modal-inner">
    <span class="sg-modal-close" onclick="closeSgModal()">âœ•</span>
    <div class="sg-modal-tag">Nouvelle suggestion</div>
    <div class="sg-modal-title">Proposer un son ğŸµ</div>
    <div class="sg-field-label">Câ€™est qui qui propose ?</div>
    <div class="sg-gender-row">
      <button class="sg-gender-btn" id="sgBtnGirl" onclick="sgSelectGender('girl')">
        <span class="sg-gender-icon girl-icon"></span>
        <span id="sgBtnGirlName">Elle</span>
      </button>
      <button class="sg-gender-btn" id="sgBtnBoy" onclick="sgSelectGender('boy')">
        <span class="sg-gender-icon boy-icon"></span>
        <span id="sgBtnBoyName">Lui</span>
      </button>
    </div>
    <div class="sg-field-label">Titre de la musique *</div>
    <input type="text" class="sg-input" id="sgTitleInput" placeholder="ex: Savage Love" maxlength="80">
    <div class="sg-field-label">Artiste *</div>
    <input type="text" class="sg-input" id="sgArtistInput" placeholder="ex: Jawsh 685" maxlength="80">
    <div class="sg-field-label">Note (optionnel)</div>
    <input type="text" class="sg-input" id="sgNoteInput" placeholder="ex: trop bonne pour toi ğŸ˜" maxlength="100">
    <div id="sgErrMsg" style="display:none;font-size:11px;color:#e05555;margin-bottom:8px;padding:8px 10px;background:rgba(220,50,50,0.07);border-radius:6px;border:1px solid rgba(220,50,50,0.2);word-break:break-all;"></div>
    <button class="sg-modal-save" onclick="sgSave()">Proposer ğŸ’š</button>
  </div>
</div>

<!-- â•â•â•â• MINI PLAYER â•â•â•â• -->
<div id="miniPlayer">
  <div class="mp-inner">
    <div class="mp-info">
      <div class="mp-title" id="mpTitle">â€”</div>
      <div class="mp-artist" id="mpArtist">â€”</div>
      <div class="mp-progress-wrap" id="mpProgressWrap">
        <div class="mp-seek" id="mpSeek">
          <div class="mp-seek-fill" id="mpSeekFill"></div>
          <div class="mp-seek-thumb" id="mpSeekThumb"></div>
        </div>
        <span class="mp-time" id="mpTime">0:00 / 0:00</span>
      </div>
    </div>
    <div class="mp-controls">
      <!-- Bouton mode (ordre/alÃ©atoire/rÃ©pÃ©ter) -->
      <button class="mp-btn mp-btn-mode" id="mpModeBtn" title="RÃ©pÃ©ter tout" onclick="mpCycleMode()">
        <svg id="mpModeIconOrder" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/>
          <polyline points="16 9 20 6 16 3"/>
        </svg>
        <svg id="mpModeIconShuffle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/>
          <polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/>
        </svg>
        <svg id="mpModeIconRepeatAll" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
          <polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
        </svg>
        <svg id="mpModeIconRepeatOne" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="display:none">
          <polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
          <polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
          <text x="10.5" y="14.5" font-size="6.5" fill="currentColor" stroke="none" font-weight="800" font-family="sans-serif" text-anchor="middle">1</text>
        </svg>
      </button>
      <!-- PrÃ©cÃ©dent -->
      <button class="mp-btn" id="mpPrevBtn" title="PrÃ©cÃ©dent" onclick="mpPrev()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z"/></svg>
      </button>
      <!-- Play/Pause -->
      <button class="mp-btn mp-btn-play" id="mpPlayBtn" title="Lecture/Pause" onclick="mpToggle()">
        <svg id="mpIconPlay" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
        <svg id="mpIconPause" viewBox="0 0 24 24" fill="currentColor" style="display:none"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
      </button>
      <!-- Suivant -->
      <button class="mp-btn" id="mpNextBtn" title="Suivant" onclick="mpNext()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
      </button>
      <!-- ArrÃªt complet -->
      <button class="mp-btn mp-btn-stop" id="mpStopBtn" title="ArrÃªter la musique" onclick="mpStop()">
        <svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
      </button>
    </div>
  </div>
</div>




<div style="padding:0 16px 20px;margin-top:0px;">
  <span style="font-size:9px;font-weight:600;color:var(--muted);letter-spacing:1.5px;opacity:0.45;font-family:'DM Sans',sans-serif;">v.27.03.08- yam 1.0</span>
</div>

<div id="dmKeyboardBg"></div>

<!-- Modal Ã©dition description pochette -->
<div id="descEditModal">
  <div class="desc-edit-sheet">
    <div class="desc-edit-handle"></div>
    <span class="desc-edit-label" id="descEditLabel">Modifier la description</span>
    <input type="text" class="desc-edit-input" id="descEditInput" maxlength="40" autocomplete="off" autocorrect="off" spellcheck="false" placeholder="Ex : Mon coin prÃ©fÃ©rÃ© ğŸŒ¿">
    <div class="desc-edit-actions">
      <button class="desc-edit-cancel" onclick="descEditClose()">Annuler</button>
      <button class="desc-edit-save" onclick="descEditSave()">Sauvegarder âœ“</button>
    </div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     âš¡ JAYANA PERF v3.0 â€” Optimisations performances
     ZÃ©ro doublon. ZÃ©ro RAF inutile. iPhone 12 ready.
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- âœ… FIX â€” instaloveAuthModal supprimÃ© (modal obsolÃ¨te) -->

<div id="skyjoAuthModal" style="display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;padding:24px;">
  <div style="background:var(--s1);border:1px solid var(--border);border-radius:20px;padding:28px 24px;max-width:300px;width:100%;text-align:center;font-family:'DM Sans',sans-serif;">
    <div style="font-size:40px;margin-bottom:10px;">ğŸƒ</div>
    <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--text);margin-bottom:6px;">Skyjo</div>
    <div style="font-size:13px;color:var(--muted);margin-bottom:20px;">Choisis ton profil pour jouer</div>
    <div style="display:flex;gap:10px;margin-bottom:16px;">
      <button id="skyjoAuthGirl" onclick="skyjoAuthSelect('girl')" style="flex:1;padding:14px 0;background:rgba(232,121,160,0.12);color:#e879a0;border:1.5px solid rgba(232,121,160,0.4);border-radius:14px;font-size:14px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;">
        <img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:44px;height:44px;border-radius:50%;object-fit:cover;display:block;">
        <span id="skyjoAuthGirlName">Elle</span>
      </button>
      <button id="skyjoAuthBoy" onclick="skyjoAuthSelect('boy')" style="flex:1;padding:14px 0;background:rgba(91,156,246,0.12);color:#5b9cf6;border:1.5px solid rgba(91,156,246,0.4);border-radius:14px;font-size:14px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;">
        <img class="yam-av-img" src="assets/images/profil_boy.png" alt="" style="width:44px;height:44px;border-radius:50%;object-fit:cover;display:block;">
        <span id="skyjoAuthBoyName">Lui</span>
      </button>
    </div>
    <span onclick="skyjoAuthClose()" style="font-size:12px;color:var(--muted);cursor:pointer;">Annuler</span>
  </div>
</div>

<!-- Overlay sombre pendant notif message -->
<div id="msgPillOverlay"></div>

<!-- Notif pilule message â€” fixed, visible sur tous les onglets -->
<div id="msgHeaderPill" onclick="_hidePillAndOpenChat()">
  <div class="mhp-avatar" id="mhpAvatar" style="overflow:hidden;"><img class="yam-av-img" src="assets/images/profil_girl.png" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;display:block;pointer-events:none;"></div>
  <div class="mhp-content">
    <div class="mhp-name" id="mhpName">Message</div>
    <div class="mhp-text" id="mhpText">â€¦</div>
  </div>
  <div class="mhp-arrow">â€º</div>
</div>


<script src="js/app-core.js"></script>
<script src="js/app-account.js"></script>
<script src="js/app-love.js"></script>
<script src="js/app-music.js"></script>
<script src="js/app-games.js"></script>
<script src="js/app-multiplayer.js"></script>
<script src="js/app-skyjo.js"></script>
<script src="js/app-pranks.js"></script>
<script src="js/app-messages.js"></script>
<script src="js/app-events.js"></script>
<script src="js/app-nav.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN V2 â€” Interface
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var _v2SelectedRole     = null;
var _v2SelectedJoinRole = null;

function v2SwitchTab(tab){
  ['login','register','join'].forEach(function(t){
    document.getElementById('v2Tab'+t.charAt(0).toUpperCase()+t.slice(1)).classList.toggle('active', t===tab);
    document.getElementById('v2Form'+t.charAt(0).toUpperCase()+t.slice(1)).style.display = t===tab ? 'flex' : 'none';
  });
  document.getElementById('v2LoginError').textContent = '';
}

function v2SelectRole(role){
  _v2SelectedRole = role;
  document.getElementById('v2RoleGirl').classList.toggle('selected', role==='girl');
  document.getElementById('v2RoleBoy').classList.toggle('selected',  role==='boy');
}

function v2SelectJoinRole(role){
  _v2SelectedJoinRole = role;
  document.getElementById('v2JoinRoleGirl').classList.toggle('selected', role==='girl');
  document.getElementById('v2JoinRoleBoy').classList.toggle('selected',  role==='boy');
}

function v2SetError(msg){ document.getElementById('v2LoginError').textContent = msg || ''; }
function v2SetLoading(on){
  document.getElementById('v2LoginLoader').style.display = on ? 'block' : 'none';
  document.querySelectorAll('.v2-btn').forEach(function(b){ b.disabled = on; });
}

function v2DoLogin(){
  var pseudo   = document.getElementById('v2LoginPseudo').value.trim();
  var password = document.getElementById('v2LoginPassword').value;
  if(!pseudo || !password){ v2SetError('Remplis tous les champs'); return; }
  v2SetError(''); v2SetLoading(true);
  v2Login(pseudo, password).then(function(res){
    v2SetLoading(false);
    if(!res.ok){ v2SetError(res.error); return; }
    v2CloseLogin();
    if(window.setProfile) window.setProfile(res.data.user.role);
  });
}

function v2DoRegister(){
  var pseudo   = document.getElementById('v2RegPseudo').value.trim();
  var password = document.getElementById('v2RegPassword').value;
  if(!pseudo || !password){ v2SetError('Remplis tous les champs'); return; }
  if(!_v2SelectedRole){ v2SetError('Choisis ton rÃ´le (Elle ou Lui)'); return; }
  v2SetError(''); v2SetLoading(true);
  v2Register(pseudo, password, _v2SelectedRole).then(function(res){
    v2SetLoading(false);
    if(!res.ok){ v2SetError(res.error); return; }
    var info = document.getElementById('v2RegInfo');
    var codeHtml = '<span id="v2CoupleCodeDisplay" style="display:inline-block;background:var(--s2);border:2px solid var(--green);border-radius:10px;padding:8px 18px;font-size:20px;font-weight:800;letter-spacing:3px;cursor:pointer;margin:6px 0;" onclick="v2CopyCode(this,\''+res.data.couple_code+'\')" title="Appuie pour copier">'+res.data.couple_code+'</span>';
    info.innerHTML = 'ğŸ‰ Compte crÃ©Ã© !<br><span style="font-size:12px;color:var(--muted)">Ton code couple :</span><br>'+codeHtml+'<br><span style="font-size:11px;color:var(--muted)">ğŸ‘† Appuie pour copier Â· partage-le Ã  ton partenaire</span>';
    info.style.display = 'block';
    setTimeout(function(){ v2CloseLogin(); if(window.setProfile) window.setProfile(res.data.user.role); }, 6000);
  });
}

function v2DoJoin(){
  var pseudo   = document.getElementById('v2JoinPseudo').value.trim();
  var password = document.getElementById('v2JoinPassword').value;
  var code     = document.getElementById('v2JoinCode').value.trim().toUpperCase();
  if(!pseudo || !password || !code){ v2SetError('Remplis tous les champs'); return; }
  if(!_v2SelectedJoinRole){ v2SetError('Choisis Elle ou Lui'); return; }
  v2SetError(''); v2SetLoading(true);
  v2Join(pseudo, password, _v2SelectedJoinRole, code).then(function(res){
    v2SetLoading(false);
    if(!res.ok){ v2SetError(res.error); return; }
    v2CloseLogin(); if(window.setProfile) window.setProfile(res.data.user.role);
  });
}

function v2CopyCode(el, code){
  if(navigator.clipboard){
    navigator.clipboard.writeText(code).then(function(){
      el.textContent = 'âœ… CopiÃ© !';
      setTimeout(function(){ el.textContent = code; }, 2000);
    }).catch(function(){
      el.textContent = 'âœ… CopiÃ© !';
      setTimeout(function(){ el.textContent = code; }, 2000);
    });
  } else {
    el.textContent = 'âœ… CopiÃ© !';
    setTimeout(function(){ el.textContent = code; }, 2000);
  }
}

function v2CloseLogin(){
  document.getElementById('v2LoginOverlay').classList.remove('active');
  // AprÃ¨s connexion, appliquer les noms dynamiques partout dans l'UI
  setTimeout(v2ApplyDynamicNames, 100);
}

function v2ShowLogin(){
  document.getElementById('v2LoginOverlay').classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   v2ApplyDynamicNames â€” Remplace Zelda/Link par les vrais pseudos
   AppelÃ©e aprÃ¨s la connexion et au chargement si session active
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function v2ApplyDynamicNames(){
  if(typeof v2GetUser !== 'function') return;
  var u = v2GetUser();
  if(!u) return;

  var girlName = u.role === 'girl' ? (u.pseudo||'Elle') : (u.partner_pseudo||'Elle');
  var boyName  = u.role === 'boy'  ? (u.pseudo||'Lui')  : (u.partner_pseudo||'Lui');

  // Popup profil
  var btnGirl = document.getElementById('ppBtnGirl');
  var btnBoy  = document.getElementById('ppBtnBoy');
  if(btnGirl) btnGirl.innerHTML = '<span class="profile-popup-dot girl"></span>' + girlName;
  if(btnBoy)  btnBoy.innerHTML  = '<span class="profile-popup-dot boy"></span>'  + boyName;

  // Bloc mÃ©tÃ©o humeur (onglet home)
  var elleEl = document.getElementById('yamMoodElleName');
  var luiEl  = document.getElementById('yamMoodLuiName');
  if(elleEl) elleEl.textContent = girlName;
  if(luiEl)  luiEl.textContent  = boyName;

  // En-tÃªtes InstaLove (DM)
  var dmGirl = document.getElementById('dmIdNameGirl');
  var dmBoy  = document.getElementById('dmIdNameBoy');
  if(dmGirl) dmGirl.textContent = girlName;
  if(dmBoy)  dmBoy.textContent  = boyName;

  // SÃ©lecteurs de jeux â€” cibler les textes par span ID ou innerHTML simple
  var gameGirlBtns = ['penduGenderGirl','puzzleGenderGirl','snakeGenderGirl'];
  var gameBoyBtns  = ['penduGenderBoy', 'puzzleGenderBoy', 'snakeGenderBoy'];
  gameGirlBtns.forEach(function(id){
    var el = document.getElementById(id); if(!el) return;
    var icon = el.querySelector('.gender-select-icon'); el.textContent = ''; if(icon) el.appendChild(icon); el.appendChild(document.createTextNode(girlName));
  });
  gameBoyBtns.forEach(function(id){
    var el = document.getElementById(id); if(!el) return;
    var icon = el.querySelector('.gender-select-icon'); el.textContent = ''; if(icon) el.appendChild(icon); el.appendChild(document.createTextNode(boyName));
  });

  // Memory â€” cibler les spans de nom
  var mgn = document.getElementById('memGenderGirlName'); if(mgn) mgn.textContent = girlName;
  var mbn = document.getElementById('memGenderBoyName');  if(mbn) mbn.textContent = boyName;

  // Skyjo auth modal
  var sgn = document.getElementById('skyjoAuthGirlName'); if(sgn) sgn.textContent = girlName;
  var sbn = document.getElementById('skyjoAuthBoyName');  if(sbn) sbn.textContent = boyName;

  // Labels Skyjo (opponent = l'autre, my = moi)
  var skyjoOpp = document.getElementById('skyjoOpponentLabel');
  var skyjoMy  = document.getElementById('skyjoMyLabel');
  if(u.role === 'girl'){
    if(skyjoMy)  skyjoMy.textContent  = girlName;
    if(skyjoOpp) skyjoOpp.textContent = boyName;
  } else {
    if(skyjoMy)  skyjoMy.textContent  = boyName;
    if(skyjoOpp) skyjoOpp.textContent = girlName;
  }
  var rlLeft  = document.getElementById('skyjoRoundLabelLeft');
  var rlRight = document.getElementById('skyjoRoundLabelRight');
  if(rlLeft)  rlLeft.textContent  = girlName;
  if(rlRight) rlRight.textContent = boyName;
  var flLeft  = document.getElementById('skyjoFinalLabelLeft');
  var flRight = document.getElementById('skyjoFinalLabelRight');
  if(flLeft)  flLeft.textContent  = girlName;
  if(flRight) flRight.textContent = boyName;

  // Labels Skyjo wait screen
  var swg = document.getElementById('skyjoWaitNameGirl'); if(swg) swg.textContent = girlName;
  var swb = document.getElementById('skyjoWaitNameBoy');  if(swb) swb.textContent = boyName;

  // InstaLove auth modal supprimÃ©

  // Boutons suggestion chanson
  var sgGirl = document.getElementById('sgBtnGirlName'); if(sgGirl) sgGirl.textContent = girlName;
  var sgBoy  = document.getElementById('sgBtnBoyName');  if(sgBoy)  sgBoy.textContent  = boyName;

  // BÃªtises
  var prankLockTitle = document.getElementById('prankLockTitle');
  if(prankLockTitle) prankLockTitle.textContent = 'AccÃ¨s bloquÃ© par ' + boyName;

  // Appliquer aussi les noms dans le profilePopup (compat app-core.js)
  if(typeof escHtml === 'function'){
    if(btnGirl) btnGirl.innerHTML = '<span class="profile-popup-dot girl"></span>' + escHtml(girlName);
    if(btnBoy)  btnBoy.innerHTML  = '<span class="profile-popup-dot boy"></span>'  + escHtml(boyName);
  }
}

// Appliquer au chargement si session dÃ©jÃ  active
(function(){
  function checkV2Session(){
    try{
      var s = JSON.parse(localStorage.getItem('yam_v2_session')||'null');
      if(s && s.token && s.expires_at && new Date(s.expires_at) > new Date()) return true;
    }catch(e){}
    return false;
  }
  if(!checkV2Session()){
    v2ShowLogin();
  } else {
    // Session active : appliquer les noms aprÃ¨s chargement des scripts
    window.addEventListener('load', function(){ setTimeout(v2ApplyDynamicNames, 200); });
  }
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIX PWA iOS â€” Safe Area & Scroll
     â€¢ Force le scroll en haut au dÃ©marrage
     â€¢ Force le scroll en haut Ã  chaque switch d'onglet
     â€¢ EmpÃªche la nav bar de paraÃ®tre "trop haute"
       quand le contenu est court (ex: onglet Jeux)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){
  // 1. Scroll en haut dÃ¨s que la page est prÃªte
  window.addEventListener('load', function(){
    setTimeout(function(){ window.scrollTo(0, 0); }, 50);
  });

  // 2. Patch yamSwitchTab : scroll en haut Ã  chaque changement d'onglet
  //    On attend que app-nav.js ait dÃ©fini la fonction, puis on la wrappe
  function patchYamSwitchTab(){
    if(typeof window.yamSwitchTab !== 'function'){
      setTimeout(patchYamSwitchTab, 100);
      return;
    }
    var _orig = window.yamSwitchTab;
    window.yamSwitchTab = function(tab){
      _orig(tab);
      if(tab === 'messages'){
        // openHiddenPage gÃ¨re en interne l'affichage de la conv (via _dmRawShowConv)
        // On ne rappelle pas dmShowConv ici pour Ã©viter le double-push dans la pile
        setTimeout(function(){
          if(typeof window.openHiddenPage === 'function') window.openHiddenPage();
        }, 30);
      } else {
        setTimeout(function(){ window.scrollTo(0, 0); }, 220);
      }
    };
  }
  patchYamSwitchTab();
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STICKY MINI HEADER â€” Script
     â€¢ DÃ©tecte le scroll et affiche/masque le mini header
     â€¢ Met Ã  jour le titre selon l'onglet actif
     â€¢ MasquÃ© sur Messages (topbar propre InstaLove)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){

  // Titres par onglet
  var TAB_TITLES = {
    home:    'Accueil',
    jeux:    'Jeux',
    musique: 'Musique',
    nous:    'Nous',
    messages: null  // masquÃ© sur Messages
  };

  var currentTab = 'home';
  var stickyEl   = null;
  var titleEl    = null;
  var ticking    = false;

  // Seuil de scroll : on attend que le grand header soit presque sorti
  // Le header fait ~120px + safe-area. On dÃ©clenche Ã  80px de scroll.
  var SCROLL_THRESHOLD = 80;

  // â”€â”€ Sync avatars depuis le grand header vers le sticky â”€â”€
  function syncAvatars() {
    var profile = (typeof getProfile === 'function') ? getProfile() : null;

    // â”€â”€ Avatar self â”€â”€
    var mainAvatar  = document.getElementById('profileAvatar');
    var stickyAvSelf = document.getElementById('yamStickyAvatarSelf');

    // Copier la classe girl/boy pour la couleur de bordure
    if (mainAvatar && stickyAvSelf) {
      if (mainAvatar.classList.contains('girl')) { stickyAvSelf.classList.add('girl'); stickyAvSelf.classList.remove('boy'); }
      else if (mainAvatar.classList.contains('boy')) { stickyAvSelf.classList.add('boy'); stickyAvSelf.classList.remove('girl'); }
    }

    // Sync image : d'abord photo uploadÃ©e, sinon image par dÃ©faut selon le profil
    var stickyImgSelf = document.getElementById('yamStickyAvatarSelfEmoji');
    var mainImgSelf   = mainAvatar ? mainAvatar.querySelector('img.profile-photo, img:not(.yam-av-img)') : null;
    var defaultSelf   = profile === 'boy' ? 'assets/images/profil_boy.png' : 'assets/images/profil_girl.png';
    if (stickyImgSelf) {
      stickyImgSelf.src = (mainImgSelf && mainImgSelf.src && !mainImgSelf.src.includes('profil_')) ? mainImgSelf.src : defaultSelf;
    }

    // â”€â”€ Avatar other â”€â”€
    var mainOther    = document.getElementById('profileAvatarOther');
    var stickyOther  = document.getElementById('yamStickyAvatarOther');
    var otherProfile = profile === 'girl' ? 'boy' : 'girl';

    if (mainOther && stickyOther) {
      if (mainOther.classList.contains('visible')) stickyOther.classList.add('visible');
      else stickyOther.classList.remove('visible');
    }

    var stickyImgOther = document.getElementById('yamStickyAvatarOtherEmoji');
    var mainImgOther   = mainOther ? mainOther.querySelector('img.profile-photo, img:not(.yam-av-img)') : null;
    var defaultOther   = otherProfile === 'boy' ? 'assets/images/profil_boy.png' : 'assets/images/profil_girl.png';
    if (stickyImgOther) {
      stickyImgOther.src = (mainImgOther && mainImgOther.src && !mainImgOther.src.includes('profil_')) ? mainImgOther.src : defaultOther;
    }

    // â”€â”€ Point prÃ©sence â”€â”€
    var mainDot   = document.getElementById('presenceDot');
    var stickyDot = document.getElementById('yamStickyPresenceDot');
    if (mainDot && stickyDot) {
      if (mainDot.classList.contains('visible')) stickyDot.classList.add('online');
      else stickyDot.classList.remove('online');
    }
  }

  function onScroll() {
    if (!ticking) {
      window.requestAnimationFrame(updateSticky);
      ticking = true;
    }
  }

  function updateSticky() {
    ticking = false;
    if (!stickyEl) return;

    // MasquÃ© sur Messages
    if (currentTab === 'messages') {
      stickyEl.style.transform = 'translateY(-100%)';
      stickyEl.style.opacity   = '0';
      stickyEl.classList.remove('visible');
      return;
    }

    var scrollY = window.scrollY || window.pageYOffset;

    // Zone de transition : entre SCROLL_START et SCROLL_END
    // â€“ En dessous de START : complÃ¨tement cachÃ©
    // â€“ Au dessus de END    : complÃ¨tement visible
    // â€“ Entre les deux      : progressif selon le scroll (suit le doigt)
    var SCROLL_START = 40;   // px â€” dÃ©but de l'apparition
    var SCROLL_END   = 100;  // px â€” pleinement visible

    if (scrollY <= SCROLL_START) {
      // CachÃ©
      stickyEl.style.transform = 'translateY(-100%)';
      stickyEl.style.opacity   = '0';
      stickyEl.classList.remove('visible');

    } else if (scrollY >= SCROLL_END) {
      // Pleinement visible
      stickyEl.style.transform = 'translateY(0)';
      stickyEl.style.opacity   = '1';
      stickyEl.classList.add('visible');

    } else {
      // Zone de transition â€” progresse linÃ©airement avec le scroll
      var progress = (scrollY - SCROLL_START) / (SCROLL_END - SCROLL_START);
      // translateY va de -100% Ã  0 proportionnellement
      var translateY = -100 + (progress * 100);
      stickyEl.style.transform = 'translateY(' + translateY + '%)';
      stickyEl.style.opacity   = String(progress);
      stickyEl.classList.add('visible'); // pointer-events actifs dÃ¨s qu'on entre dans la zone
    }
  }

  function setTab(tab) {
    currentTab = tab;
    if (!titleEl) return;

    var title = TAB_TITLES[tab];
    if (title) {
      titleEl.textContent = title;
    }

    // Au switch d'onglet le scroll repasse Ã  0 â†’ cacher immÃ©diatement sans animation
    if (stickyEl) {
      stickyEl.style.transition = 'none';
      stickyEl.style.transform  = 'translateY(-100%)';
      stickyEl.style.opacity    = '0';
      stickyEl.classList.remove('visible');
      // RÃ©activer aprÃ¨s un frame pour ne pas bloquer les futurs scrolls
      requestAnimationFrame(function() {
        if (stickyEl) stickyEl.style.transition = '';
      });
    }
  }

  function init() {
    stickyEl = document.getElementById('yamStickyHeader');
    titleEl  = document.getElementById('yamStickyHeaderTitle');

    if (!stickyEl || !titleEl) return;

    // Ã‰couter le scroll
    window.addEventListener('scroll', onScroll, { passive: true });

    // Sync avatars toutes les 2s (couvre prÃ©sence, humeurs, changement profil)
    syncAvatars();
    setInterval(syncAvatars, 2000);

    // Patcher yamSwitchTab pour mettre Ã  jour le titre
    function patchTitle() {
      if (typeof window.yamSwitchTab !== 'function') {
        setTimeout(patchTitle, 150);
        return;
      }
      var _orig = window.yamSwitchTab;
      window.yamSwitchTab = function(tab) {
        _orig(tab);
        setTab(tab);
      };
    }
    patchTitle();
  }

  // Lancer aprÃ¨s chargement complet
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // â”€â”€ Ouvrir le popup profil depuis le sticky header â”€â”€
  // On force l'ouverture directement plutÃ´t que de passer par toggleProfilePopup()
  // qui peut dÃ©pendre de l'Ã©tat de l'avatar du grand header (hors Ã©cran au scroll)
  // Ouvrir le popup profil depuis le sticky header
  // toggleProfilePopup() fonctionne correctement depuis le fix de app-account.js
  window.yamStickyOpenProfile = function() {
    if (typeof window.toggleProfilePopup === 'function') {
      window.toggleProfilePopup();
    }
  };

})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DMSTATUS â€” Statut prÃ©sence partenaire
     Observe dmHeaderDotOther et met Ã  jour
     le texte "En ligne / Hors ligne" en temps rÃ©el
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){

  var ONLINE_COLOR_PART = '34, 197, 94'; // #22c55e

  function isOtherOnline() {
    var dot = document.getElementById('dmHeaderDotOther');
    if (!dot) return false;
    var bg = window.getComputedStyle(dot).backgroundColor;
    return bg.indexOf(ONLINE_COLOR_PART) !== -1;
  }

  function updateDmStatus() {
    var status = document.getElementById('dmStatus');
    if (!status) return;
    if (isOtherOnline()) {
      status.textContent = 'â€¢ En ligne';
      status.style.color = '#22c55e';
    } else {
      status.textContent = 'â€¢ Hors ligne';
      status.style.color = 'var(--muted)';
    }
  }

  function startObserver() {
    var dot = document.getElementById('dmHeaderDotOther');
    if (!dot) return false;
    var observer = new MutationObserver(function() {
      setTimeout(updateDmStatus, 30);
    });
    observer.observe(dot, { attributes: true, attributeFilter: ['style'] });
    return true;
  }

  function init() {
    startObserver();
    updateDmStatus();
    setInterval(updateDmStatus, 3000);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PATCH AVATARS PAR DÃ‰FAUT â€” initialise les images selon le profil
     AppelÃ© aprÃ¨s tous les scripts, corrige aussi _acSyncAvatarTopbar
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){
  function initDefaultAvatars(){
    var profile = (typeof getProfile === 'function') ? getProfile() : null;
    var self    = profile || 'girl';
    var other   = (self === 'girl') ? 'boy' : 'girl';

    // Header principal
    var elEmoji = document.getElementById('profileAvatarEmoji');
    var othEmoji = document.getElementById('profileAvatarOtherEmoji');
    if(elEmoji && elEmoji.tagName === 'IMG')  elEmoji.src  = window.yamAvatarSrc(self);
    if(othEmoji && othEmoji.tagName === 'IMG') othEmoji.src = window.yamAvatarSrc(other);

    // Mood avatars
    var moodElle = document.getElementById('yamMoodElleAvatar');
    var moodLui  = document.getElementById('yamMoodLuiAvatar');
    if(moodElle){ var img = moodElle.querySelector('img'); if(img) img.src = window.yamAvatarSrc('girl'); }
    if(moodLui) { var img2 = moodLui.querySelector('img');  if(img2) img2.src = window.yamAvatarSrc('boy'); }

    // InstaLove header topbar
    var dmSelf  = document.getElementById('dmHeaderAvatarSelf');
    var dmOther = document.getElementById('dmHeaderAvatarOther');
    if(dmSelf)  { var i1 = dmSelf.querySelector('img');  if(i1) i1.src = window.yamAvatarSrc(self);  }
    if(dmOther) { var i2 = dmOther.querySelector('img'); if(i2) i2.src = window.yamAvatarSrc(other); }

    // mhpAvatar (header notif pilule)
    var mhp = document.getElementById('mhpAvatar');
    if(mhp){ var im = mhp.querySelector('img'); if(im) im.src = window.yamAvatarSrc(self); }
  }

  // Patcher _acSyncAvatarTopbar pour qu'il mette aussi l'image par dÃ©faut
  // (app-account.js y met l'emoji quand pas de photo â€” on override)
  function patchAcSync(){
    var orig = window._acSyncAvatarTopbar;
    if(!orig){ setTimeout(patchAcSync, 200); return; }
    window._acSyncAvatarTopbar = function(profile, avatarUrl){
      if(orig) orig.apply(this, arguments);
      // AprÃ¨s le sync original, si l'emoji est encore lÃ , le remplacer par l'image par dÃ©faut
      var avEl = document.getElementById('profileAvatarEmoji');
      if(avEl && avEl.tagName === 'IMG'){
        // Si app-account a mis une vraie photo, elle est dans un <img> sÃ©parÃ© â€” ne pas Ã©craser
        // Sinon mettre le dÃ©faut selon le profil
        if(!avatarUrl) avEl.src = window.yamAvatarSrc(profile || getProfile() || 'girl');
      }
      initDefaultAvatars();
    };
  }

  // Initialiser au chargement
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', function(){
      initDefaultAvatars();
      patchAcSync();
    });
  } else {
    initDefaultAvatars();
    patchAcSync();
  }

  // RÃ©-initialiser aussi quand le profil change (setProfile)
  var _origSetProfile = window.setProfile;
  function hookSetProfile(){
    if(typeof window.setProfile !== 'function'){ setTimeout(hookSetProfile, 300); return; }
    if(window._yamAvatarHooked) return;
    window._yamAvatarHooked = true;
    var orig = window.setProfile;
    window.setProfile = function(p){
      orig.apply(this, arguments);
      setTimeout(initDefaultAvatars, 100);
    };
  }
  setTimeout(hookSetProfile, 500);
})();
</script>
</body>
</html>
